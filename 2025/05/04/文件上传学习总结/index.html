

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/chongqing.jpg">
  <link rel="icon" href="/img/chongqing.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="sangnigege">
  <meta name="keywords" content="一个做事不将就的人，阻止他的只有时间">
  
    <meta name="description" content="前言 本文是作者由CSDN博客迁移而来，原文地址：https:&#x2F;&#x2F;blog.csdn.net&#x2F;2302_81178149&#x2F;article&#x2F;details&#x2F;145433812  我们下面进行下一个漏洞——文件上传的学习。文件上传是常见漏洞之一，是Web安全必学漏洞。 为探讨清楚文件上传漏洞的诸多细节，我们特选经典的upload-labs进行从入门到进阶的专项训练。本文是经由upload-labs训练">
<meta property="og:type" content="article">
<meta property="og:title" content="文件上传学习总结">
<meta property="og:url" content="http://example.com/2025/05/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="重庆森林不在重庆">
<meta property="og:description" content="前言 本文是作者由CSDN博客迁移而来，原文地址：https:&#x2F;&#x2F;blog.csdn.net&#x2F;2302_81178149&#x2F;article&#x2F;details&#x2F;145433812  我们下面进行下一个漏洞——文件上传的学习。文件上传是常见漏洞之一，是Web安全必学漏洞。 为探讨清楚文件上传漏洞的诸多细节，我们特选经典的upload-labs进行从入门到进阶的专项训练。本文是经由upload-labs训练">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911990.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911876.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911630.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911145.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505041651602.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505041651060.png">
<meta property="article:published_time" content="2025-05-04T09:16:00.000Z">
<meta property="article:modified_time" content="2025-05-04T09:17:30.539Z">
<meta property="article:author" content="sangnigege">
<meta property="article:tag" content="学习总结">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911990.png">
  
  
  
  <title>文件上传学习总结 - 重庆森林不在重庆</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"TKccC2BvrQ0jKroA5aUdv8tr-gzGzoHsz","app_key":"rSHs3EnI9lT7nQwv5J7fcBnq","server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>重庆森林不在重庆</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="文件上传学习总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-05-04 17:16" pubdate>
          2025年5月4日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          52 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">文件上传学习总结</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>本文是作者由CSDN博客迁移而来，原文地址：<a target="_blank" rel="noopener" href="https://blog.csdn.net/2302_81178149/article/details/145433812">https://blog.csdn.net/2302_81178149/article/details/145433812</a></p>
</blockquote>
<p>我们下面进行下一个漏洞——文件上传的学习。文件上传是常见漏洞之一，是Web安全必学漏洞。</p>
<p>为探讨清楚文件上传漏洞的诸多细节，<strong>我们特选经典的upload-labs进行从入门到进阶的专项训练</strong>。本文是经由upload-labs训练总结而来，<strong>所以配合作者的upload-labs通关全详解食用更佳（怎么可以光学习不训练呢）</strong>。</p>
<p> upload-labs通关：<a target="_blank" rel="noopener" href="https://blog.csdn.net/2302_81178149/article/details/145442006" title="upload-labs通关全详解-CSDN博客">upload-labs通关全详解-CSDN博客</a></p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>这里大家最好还要有一些php基础，能大概读懂代码就可以；至于html之类的，大家经过之前的学习已经满足要求了。</p>
<ul>
<li>PHP 文件的默认扩展名是 “.php”  </li>
<li>PHP 文件中可以包含 html、css、JavaScript 代码</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>组成</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>&lt;?php ... ?&gt;</code></td>
<td>PHP 标记</td>
</tr>
<tr>
<td>2</td>
<td>PHP代码</td>
<td>函数、数组、流程控制、类、方法…</td>
</tr>
<tr>
<td>3</td>
<td><code>;</code>、<code>()</code></td>
<td>语句结束符</td>
</tr>
<tr>
<td>4</td>
<td>空白符</td>
<td>合理使用空白符可增强代码可读性</td>
</tr>
<tr>
<td>5</td>
<td>注释</td>
<td><code>// 单行注释</code>，<code>/* 多行注释 */</code></td>
</tr>
</tbody></table>
<h2 id="文件上传基础"><a href="#文件上传基础" class="headerlink" title="文件上传基础"></a>文件上传基础</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>文件上传是web系统中常见的一种功能，通过文件上传能实现上传图片、视频，以及其他类型的文件。</p>
<p>文件上传漏洞是指用户利用文件上传功能上传了一个可以执行的脚本文件，并且可以通过该文件获得服务器的权限的一种漏洞。</p>
<p>说白了，文件上传漏洞就是用户通过上传恶意文件去入侵服务器的一种漏洞。这个恶意文件被称为webshell，也可以称为一种网页后门。</p>
<h3 id="关于webshell"><a href="#关于webshell" class="headerlink" title="关于webshell"></a>关于webshell</h3><ul>
<li>拥有较完整功能的webshell，我们一般称为大马。</li>
<li>功能简易的webshell称为小马。</li>
<li>除此之外还存在一句话木马、菜刀马、脱库马等等的名词，是对于webShell功能或者特性的简称。</li>
</ul>
<h3 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h3><p>在upload-labs中我们主要用了一句话木马，故这里对一句话木马进行简单解析。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>&lt;?php ……?&gt;</code>是PHP标记，是PHP标记，代表着这是一句PHP代码</p>
<p>eval()在PHP手册里的解释：</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911990.png" srcset="/img/loading.gif" lazyload></p>
<p><code>$_POST[]</code>其实是一种全局变量</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>$_GET</code></td>
<td>收集来自 <code>method=&quot;get&quot;</code> 的表单中的值</td>
</tr>
<tr>
<td><code>$_POST</code></td>
<td>收集来自 <code>method=&quot;post&quot;</code> 的表单中的值</td>
</tr>
<tr>
<td><code>$_REQUEST</code></td>
<td>包含 <code>$_POST</code>、<code>$_GET</code> 和 <code>$_COOKIE</code></td>
</tr>
<tr>
<td><code>$GLOBALS</code></td>
<td>全部变量的全局组合数组</td>
</tr>
<tr>
<td><code>$_COOKIE</code></td>
<td>常用于识别用户</td>
</tr>
<tr>
<td><code>$_SESSION</code></td>
<td>存储关于用户会话（session）的信息</td>
</tr>
<tr>
<td><code>$_FILES</code></td>
<td>用来获取通过 POST 方法上传文件的相关信息</td>
</tr>
<tr>
<td><code>$_SERVER</code></td>
<td>服务器和执行环境信息</td>
</tr>
<tr>
<td><code>$_ENV</code></td>
<td>环境变量</td>
</tr>
</tbody></table>
<p>这样我们就可以综合起来看这一句话木马的含义，其实就是一句PHP代码，收集所有用POST方法传递的key的值（这个‘key’是我们任意起的名字），并将其执行</p>
<p>比如我们用POST方法传递一个key&#x3D;phpinfo();</p>
<p>此时一句话木马就是<code>&lt;?php @eval(phopinfo(););?&gt;</code></p>
<p>那么就会执行phpinfo()函数</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911876.png" srcset="/img/loading.gif" lazyload></p>
<p>然后我们还可以去进一步利用，比如通过system()函数，<code>key=system(ipconfig);</code>去查一下ip等等</p>
<p>不过最便捷的方法还是直接连接中国蚁剑，蚁剑必须要用$_POST的密码，这也是为什么我们优先用这个一句话木马。具体的连接方式请见upload-labs通关。</p>
<p>我们在upload-labs中还用到的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;function&#x27;</span>](<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>也都是同理。 </p>
<h2 id="文件上传详解"><a href="#文件上传详解" class="headerlink" title="文件上传详解"></a>文件上传详解</h2><h3 id="文件上传漏洞前提"><a href="#文件上传漏洞前提" class="headerlink" title="文件上传漏洞前提"></a>文件上传漏洞前提</h3><ol>
<li>文件可上传</li>
<li>上传路径可知</li>
<li>上传文件可以被解释执行或被包含</li>
</ol>
<h3 id="存在的风险点"><a href="#存在的风险点" class="headerlink" title="存在的风险点"></a>存在的风险点</h3><p>所有存在文件上传的地方都可能存在相关的漏洞，都可以进行测试，比如说上传头像、上传身份认证等</p>
<h3 id="文件上传测试思路及方法"><a href="#文件上传测试思路及方法" class="headerlink" title="文件上传测试思路及方法"></a>文件上传测试思路及方法</h3><p>对于上传点测试思路及其方法如下图，</p>
<p>思路：</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911630.png" srcset="/img/loading.gif" lazyload></p>
<p>方法：</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505021911145.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="文件上传总结"><a href="#文件上传总结" class="headerlink" title="文件上传总结"></a>文件上传总结</h2><p>这里我们根据上面内容进行总结。</p>
<h3 id="js检查"><a href="#js检查" class="headerlink" title="js检查"></a>js检查</h3><p>在做文件上传题目时，我们应该直接上传不同的文件，去检测是否有过滤，但是同时也不能忘记查看一下前端代码，看看是否是前端过滤</p>
<p>如果是前端过滤，那么我们应该：</p>
<p>方法一：利用浏览器的机制可以禁用js</p>
<p>方法二：删除浏览器事件</p>
<p>这属于前端验证，下面我们讲后端验证</p>
<h3 id="检查后缀"><a href="#检查后缀" class="headerlink" title="检查后缀"></a>检查后缀</h3><h4 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h4><p>有可能是后缀黑名单，过滤了一部分上传的文件。</p>
<p>1、这里我们考虑上传特殊可解析后缀</p>
<p>常用过滤后缀：<code>php、php2、php3、php4、php5、php6、php7、pht、phtm、phtml</code>。</p>
<p>下面我们详细讲解一下。</p>
<p>PHP是一种广泛使用的开放源代码的服务器端脚本语言，主要用于Web开发。默认情况下，PHP文件具有.php扩展名，但是服务器可以被配置为接受其他文件扩展名作为PHP文件来处理。以下是一些可能被服务器配置为识别并解析为PHP脚本的文件扩展名：</p>
<ul>
<li><p><strong>.php</strong> - 这是最常见的PHP文件扩展名。</p>
</li>
<li><p><strong>.php3</strong> - 早期的PHP版本使用的扩展名。</p>
</li>
<li><p><strong>.php4</strong> - 用于PHP 4.x系列。</p>
</li>
<li><p><strong>.php5</strong> - 用于PHP 5.x系列。</p>
</li>
<li><p><strong>.php7</strong> - 用于PHP 7.x系列。</p>
</li>
<li><p><strong>.php8</strong> - 用于PHP 8.x系列。</p>
</li>
<li><p><strong>.phtml</strong> - 这是PHP混合HTML文件使用的另一个旧扩展名。</p>
</li>
<li><p><strong>.phps</strong> - 用来显示源代码的高亮显示而不是执行它。</p>
</li>
<li><p><strong>.html or .htm</strong> - 有时服务器被配置为执行嵌入在HTML文件中的PHP代码。</p>
</li>
<li><p><strong>.inc</strong> - 有时用于包含文件，但这不是一个安全做法，因为它可能会暴露敏感代码。</p>
</li>
</ul>
<p><strong>但是注意利用特殊可解析后缀是有条件的：</strong></p>
<ul>
<li>服务器需要通过修改配置文件来支持上述其他扩展名。</li>
</ul>
<p>对于Apache服务器，这通常在<code>.htaccess</code>文件中或者直接在主配置文件<code>httpd.conf</code>中，使用<code>AddType</code>和<code>AddHandler</code>指令来完成。对于Nginx服务器，可以在<code>nginx.conf</code>中通过设置<code>location</code>块并使用<code>fastcgi_pass</code>指令来处理。</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">AddType application/x-httpd-php <span class="hljs-string">.php</span> <span class="hljs-string">.php3</span> <span class="hljs-string">.php4</span> <span class="hljs-string">.php5</span> <span class="hljs-string">.php6</span> <span class="hljs-string">.php7</span> <span class="hljs-string">.php8</span> <span class="hljs-string">.phtml</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><p>还有一些其他的从后缀下手的方法</p>
<ul>
<li>大小写绕过</li>
</ul>
<p>有时候没有对文件名进行强制小写转换，我们可以通过修改文件名为大写来绕过限制的</p>
<ul>
<li>空格绕过</li>
</ul>
<p>因为Windows特性，在文件资源管理器中对后缀名添加空格的操作是不允许的（会自动去除文件末尾的点和空格的），所以这里我们需要使用Burpsuite抓包修改文件名。</p>
<ul>
<li>点绕过</li>
</ul>
<p>windows环境时会自动去除文件末尾的点和空格的，所以还是bp抓包</p>
<ul>
<li><code>::$DATA</code>绕过</li>
</ul>
<p><strong>在windows环境下，不光会自动去除文件末尾的点和空格，同时(::$DATA)这个字符串，windows也会认为是非法字符，默认去除掉</strong></p>
<ul>
<li>双后缀名绕过</li>
</ul>
<p>有时候将危险后缀都替换为空，但又不是递归替换，所以我们可以双写绕过</p>
</li>
<li><p><code>.htaccess</code>文件解析漏洞</p>
</li>
</ol>
<p>像实际中我们并不能修改服务器配置文件，而开发人员又没有设置特殊可解析后缀。这时候我们往往需要利用.htaccess文件解析漏洞。</p>
<p>常见配法有以下几种：</p>
<pre><code class="hljs">AddHandler php5-script .jpg
AddType application/x-httpd-php .jpg
Sethandler application/x-httpd-php
</code></pre>
<p>Sethandler 将该目录及子目录的所有文件均映射为php文件类型。</p>
<p>Addhandler 使用 php5-script 处理器来解析所匹配到的文件。</p>
<p>AddType 将特定扩展名文件映射为php文件类型。</p>
<p>简单来说就是，可以将我们所的文件都解析成php或者是特定的文件解析为php。</p>
<p>那么我们创建一个.htaccess文件</p>
<p>写上内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Sethandler application/x-httpd-php<br></code></pre></td></tr></table></figure>

<p>这是将本目录及所有子目录的所有文件都解析为php文件。</p>
<p>然后我们就可以上传允许上传的内容，然后解析为php文件</p>
<p><strong>这里我们强调使用<code>.htaccess</code>的条件：</strong></p>
<ul>
<li>.htaccess针对Apache网络服务器</li>
</ul>
<ol start="5">
<li><code>.user.ini</code>文件解析漏洞</li>
</ol>
<p>这时候我们先需要了解下面几个配置文件的区别</p>
<ul>
<li>php.ini</li>
</ul>
<blockquote>
<p>php.ini是php默认的配置文件，其中包括了很多php的配置，这些配置中，又分为几种：PHP_INI_SYSTEM、PHP_INI_PERDIR、PHP_INI_ALL、PHP_INI_USER。<br>PHP_INI_USER的配置项，可以在ini_set()函数中设置、注册表中设置，.user.ini中设置。</p>
</blockquote>
<ul>
<li>.user.ini</li>
</ul>
<blockquote>
<p>.user.ini文件<br>.user.ini实际上就是一个可以由用户“自定义”的php.ini，我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。<br>它比.htaccess(分布式配置文件)用的更广，不管是nginx&#x2F;apache&#x2F;IIS，只要是以fastcgi(进程管理器)运行的php都可以用这个方法。<br>Php配置项中有两个比较有意思的项<br>auto_prepend_file指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。<br>auto_append_file类似，只是在文件后面包含。</p>
</blockquote>
<ul>
<li>.htaccess</li>
</ul>
<blockquote>
<p>.htaccess叫分布式配置文件，它提供了针对目录改变配置的方法——在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。并且子目录中的指令会覆盖更高级目录或者主服务器配置文件中的指令。一般来说，如果你的虚拟主机使用的是Unix或Linux系统，或者任何版本的Apache网络服务器，从理论上讲都是支持.htaccess的。<br>目录规则:一般我们将.htaccess文件放置在网站的根目录，控制所在目录及所有子目录，而如果放置在子目录中，会受上级目录中.htaccess文件影响，是不起任何作用的。<br>.htaccess可以实现：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</p>
</blockquote>
<p>所以.htaccess相对而言是比较针对Apache网络服务器，而.user.ini文件不管是nginx&#x2F;apache&#x2F;IIS，只要是以fastcgi(进程管理器)运行的php都可以用这个方法</p>
<p>user.ini ：自 PHP 5.3.0 起，PHP 支持基于每个目录的 .htaccess 风格的 INI 文件。此类文件仅被CGI／FastCGI SAPI 处理。此功能使得 PECL 的 htscanner 扩展作废。如果使用 Apache，则用.htaccess文件有同样效果。</p>
<p>除了主php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web根目录（$_SERVER[‘DOCUMENT_ROOT’] 所指定的）。如果被执行的 PHP文件在 web 根目录之外，则只扫描该目录。</p>
<p>在.user.ini 风格的 INI 文件中只有具有 PHP_INI_PERDIR 和 PHP_INI_USER 模式的 INI设置可被识别。</p>
<p>两个新的 INI 指令，user_ini.filename 和 user_ini.cache_ttl 控制着用户 INI 文件的使用。</p>
<p>user_ini.filename 设定了 PHP 会在每个目录下搜寻的文件名；如果设定为空字符串则 PHP 不会搜寻。默认值是 .user.ini。</p>
<p>user_ini.cache_ttl 控制着重新读取用户 INI 文件的间隔时间。默认是 300 秒（5 分钟）。</p>
<p>我们可以用.user.ini去包含我们的代码，然后执行，.user.ini相当于一个用户自定义的php.ini。</p>
<p>制作一个.user.ini文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">auto_prepend_file=<span class="hljs-number">1</span>.jpg<br></code></pre></td></tr></table></figure>

<p>“auto_prepend_file指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数”</p>
<p>所以.user.ini文件里的意思是：所有的php文件都自动包含我们刚刚上传的1.jpg文件，会将其执行。</p>
<p><strong>这里我们强调使用.user.ini的条件：</strong></p>
<ul>
<li><p>以fastcgi(进程管理器)运行的php</p>
</li>
<li><p>上传路径下必须有PHP文件，用来包含我们的一句话木马</p>
</li>
</ul>
<h4 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h4><p>后端有可能是MIME检查，那我们就选择可以上传的MIME进行绕过</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>典型示例</th>
</tr>
</thead>
<tbody><tr>
<td>text</td>
<td>表明文件是普通文本，理论上是人类可读</td>
<td>text&#x2F;plain, text&#x2F;html, text&#x2F;css, text&#x2F;javascript</td>
</tr>
<tr>
<td>image</td>
<td>表明是某种图像。不包括视频，但是动态图（比如动态 gif）也使用 image 类型</td>
<td>image&#x2F;gif, image&#x2F;png, image&#x2F;jpeg, image&#x2F;bmp, image&#x2F;webp, image&#x2F;x-icon, image&#x2F;vnd.microsoft.icon</td>
</tr>
<tr>
<td>audio</td>
<td>表明是某种音频文件</td>
<td>audio&#x2F;midi, audio&#x2F;mpeg, audio&#x2F;webm, audio&#x2F;ogg, audio&#x2F;wav</td>
</tr>
<tr>
<td>video</td>
<td>表明是某种视频文件</td>
<td>video&#x2F;webm, video&#x2F;ogg</td>
</tr>
<tr>
<td>application</td>
<td>表明是某种二进制数据</td>
<td>application&#x2F;octet-stream, application&#x2F;pkcs12, application&#x2F;vnd.mspowerpoint, application&#x2F;xhtml+xml, application&#x2F;xml, application&#x2F;pdf</td>
</tr>
</tbody></table>
<p>•text&#x2F;html：HTML格式<br>•text&#x2F;plain：纯文本格式<br>•text&#x2F;xml：XML格式<br>•text&#x2F;css：CSS格式<br>•text&#x2F;javascript：JS格式<br>•image&#x2F;gif：GIF图片格式<br>•image&#x2F;jpeg：JPG图片格式<br>•image&#x2F;png：PNG图片格式<br>•image&#x2F;svg+xml：SVG矢量图格式<br>•video&#x2F;mpeg：MPEG动画格式<br>•application&#x2F;xhtml+xml：XHTML格式<br>•application&#x2F;xml：XML数据格式<br>•application&#x2F;json：JSON数据格式<br>•application&#x2F;atom+xml：Atom+XML聚合格式<br>•application&#x2F;pdf：PDF文档格式<br>•application&#x2F;msword：Word文档格式<br>•application&#x2F;octet-stream：二进制数据流（如常见的文件下载）<br>•application&#x2F;x-www-form-urlencoded：form表单被编码成key&#x2F;value格式发送到服务器（表单默认提交数据的格式）<br>•multipart&#x2F;form-data：POST 提交时伴随文件上传的表单</p>
<p>但是当使用MIME也无法绕过时，我们就要考虑别的方法。</p>
<p>比如说00截断。</p>
<blockquote>
<p>【00截断原理】</p>
<p>谈到00截断我们都会想到，有什么0x00截断、%00截断，也有人对两个东西分析一大堆，那么它俩有什么区别呢，什么场合适用哪一个呢？</p>
<p>这就要从00截断的原理说起：</p>
<p>其实截断的原理也很简单，无论0x00还是%00，最终被解析后都是一个东西:chr（0）。</p>
<p>char(0)是什么东西？</p>
<p>chr()是一个函数，这个函数是用来返回参数所对应的字符的，也就是说，参数是一个ASCII码，返回的值是一个字符，类型为string。</p>
<p>那么chr(0)就很好理解了，对照ASCII码表可以知道，ASCII码为0-127的数字，每个数字对应一个字符，而0对应的就是NUT字符（NULL），也就是空字符</p>
<p>而截断的关键就是这个空字符，当一个字符串中存在空字符的时候，在被解析的时候会导致空字符后面的字符被丢弃。</p>
<p>这种情况常出现在ASP程序中，PHP 版本&lt;5.3.4时也会有这个情况，JSP中也会出现。</p>
<p>那么就可以知道00截断的原理了，在后缀中插入一个空字符（不是空格），会导致之后的部分被丢弃，而导致绕过的发生。如：在文件1.php.jpg中插入空字符变成：1.php.0x00.jpg中，解析后就会只剩下1.php</p>
</blockquote>
<p>至于是利用0x00还是%00，这就要看传递文件名时的方式</p>
<p>用GET传就用%00，用POST传就用0x00</p>
<blockquote>
<p>而空字符0x00怎么插入的呢？</p>
<p>通常我们会用Burp抓包后，在文件名插入一个空格，然后再HEX中找到空格对应的16进制编码“20”，把它改成00（即16进制ASCII码00，对应十进制的0），就可以插入空字符了。</p>
<p>PS:这里的空格纯粹只是一个标记符号，便于我们找到位置，其实这里是什么字符都无所谓，只不过空格比较有特异性，方便在HEX中查找位置</p>
</blockquote>
<h3 id="检查内容"><a href="#检查内容" class="headerlink" title="检查内容"></a>检查内容</h3><p>有时候我们上传文件时，会检查文件中是否含有<code>&lt;?</code>,</p>
<p>这时候，我们就可以用如下木马：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_POST[<span class="hljs-string">&#x27;a&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <br></code></pre></td></tr></table></figure>

<p>当然检查内容最常见的还是图片马，我们下面主要从图片马的角度讲解.</p>
<p><strong>注意图片马有利用条件：</strong></p>
<ul>
<li>有文件包含漏洞或者是可以上传<code>.user.ini</code>文件，才可以利用图片马</li>
</ul>
<ol>
<li>文件头检查</li>
</ol>
<p>PEG&#x2F;IFIF（常见的照片格式)：头两个字节为·0 xFF·0xD8。</p>
<p>PNG（无损压缩格式)：头两个字节为·0x89·0x50。</p>
<p>GIF（支持动画的图像格式)：头两个字节为·0x47·0x49。</p>
<p>BMP(Windows位图格式)：头两个字节为·0x42·0x4D。</p>
<p>在同时有图片和一句话木马的文件夹下打开cmd，然后使用以下命令。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">copy 图片名 /b + 一句话木马的文件名 /a webshell.jpg<br></code></pre></td></tr></table></figure>

<p>意思是将一句话木马文件中的代码追加到图片中并重新生成一个叫webshell.php的代码。</p>
<ol start="2">
<li>getimagesize()</li>
</ol>
<p>getimagesize())会对目标的十六进制的前几个字符串进行读取。getimagesize() 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型及图片高度与宽度。</p>
<ol start="3">
<li>exif_imagetype()</li>
</ol>
<p>exif_imagetype()读取一个图像的第一个字节并检查其后缀名。</p>
<p>还是可以用之前的图片马绕过</p>
<ol start="4">
<li>二次渲染</li>
</ol>
<p>二次渲染会创建一个新图象，成功则返回图像标识符&#x2F;图像资源，失败则返回false，从而会导致图片马的数据丢失，上传的图片马无法执行。</p>
<p>二次渲染是后端重写文件内容，常见会用到的函数有：</p>
<pre><code class="hljs">basename(path[,suffix])没指定suffix则返回后缀名，有则不返回指定的后缀名
 
strrchr(string,char)函数查找字符串在另一个字符串中最后一次出现的位置，并返回从该位置到字符串结尾的所有字符。
 
imagecreatefromgif()：创建一块画布，并从 GIF 文件或 URL 地址载入一副图像
 
imagecreatefromjpeg()：创建一块画布，并从 JPEG 文件或 URL 地址载入一副图像
 
imagecreatefrompng()：创建一块画布，并从 PNG 文件或 URL 地址载入一副图像
</code></pre>
<p>按照前面的方式上传，可以上传，但是包含漏洞无法解析。原因就是二次渲染将图片马里面的php代码打乱了。</p>
<p>这里我们需要使用二次渲染专用图。</p>
<p>具体制作二次渲染图片马的方式如下：</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/2337#toc-6">https://xz.aliyun.com/news/2337#toc-6</a></p>
<h3 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a>代码逻辑</h3><p>这里主要指条件竞争，主要是设计逻辑的问题，可以参考upload-labs第18、19关</p>
<h3 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h3><p>count()函数漏洞是一个具体情境，这里就不进行总结，具体可看upload-labs第21关</p>
<h3 id="其他绕过"><a href="#其他绕过" class="headerlink" title="其他绕过"></a>其他绕过</h3><p>作者在总结文章时，发现其他人整理的其他绕过方法，这里简单列出，仅供参考。</p>
<h4 id="解压缩getshell"><a href="#解压缩getshell" class="headerlink" title="解压缩getshell"></a>解压缩getshell</h4><p>渗透的时候，有时候会需要后台通过上传压缩包进行部署的功能，上传成功后自解压到指定目录。</p>
<h4 id="解析漏洞详解"><a href="#解析漏洞详解" class="headerlink" title="解析漏洞详解"></a>解析漏洞详解</h4><p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zzz6583zz/article/details/141608529">https://blog.csdn.net/zzz6583zz/article/details/141608529</a></p>
<p>除了上面我们提到的两种解析漏洞，还有别的解析漏洞，我们这里对解析漏洞进行详解</p>
<p>解析漏洞解释：解析漏洞就是指服务器应用程序在解析某些精心构造的后缀文件的时候，会将相关的文件解析成网页的脚本，从而导致实现控制网站，同时大部分的解析漏洞都是由应用程序产生的。</p>
<p>一、IIS解析漏洞</p>
<ol>
<li>IIS5.0&#x2F;6.0</li>
</ol>
<ul>
<li>目录解析</li>
</ul>
<p>​	在以. asp文件名的文件夹下的任何文件都将作为asp文件执行。<br>     也就是当目录为XX.asp的时候，那么当访问下面的图片的时候，如XX.aps&#x2F;1.jpg就会被当作ASP执行。</p>
<ul>
<li>文件解析</li>
</ul>
<p>​	如果文件为1.asp;.jpg，由于IIS不解析;后面的内容，使用就会把文件当作1.asp进行解析，同时还存在.asa、.cer、.cdx可以进行解析。</p>
<ul>
<li>修复建议</li>
</ul>
<p>​	 1）限制上传目录的执行权限，不允许执行脚本。<br>   2）不允许创建目录。<br>   3）上传的文件进行重命名。</p>
<ol start="2">
<li>IIS7.0&#x2F;IIS7.5</li>
</ol>
<ul>
<li>IIS7.0&#x2F;IIS7.5Fast-CGI</li>
</ul>
<p>​	在Fast-CGI开启的状态下，在类似1.jpg后面加上&#x2F;1.php,变成&#x2F;1.jpg&#x2F;1.php路径会解析成PHP文件。需要进入php.ini里面修改cig.cgi_ pathinfo&#x3D;1。<br>   将1.txt文本文件中的后门代码写入到1.jpg图片的二进制代码：<br> copy 1.jpg&#x2F;b + 1.txt&#x2F;a 1.jpg<br>   1.txt的文件内容为：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&lt;<span class="hljs-string">?P</span>HP <br>fputs(fopen(<span class="hljs-string">&#x27;shell.php&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>),<span class="hljs-string">&#x27;&lt;?php eval($_POST[password])?&gt;&#x27;</span>);<br><span class="hljs-string">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>​	当在图片文件中写入后门代码，当访问这个图片的时候加上&#x2F;.php的时候就会在当前目录下生成一句话木马shell.php。</p>
<ul>
<li>修复建议</li>
</ul>
<p>​	配置cgi.fix_pathinfo(php.ini中)为0并重启php-cgi程序<br> <img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505041651602.png" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<p>二、apache解析漏洞</p>
<ol>
<li>apache解析漏洞</li>
</ol>
<ul>
<li><p>在apache1.x和apache2.x中存在解析漏洞。<br>   当一个文件为1.php.yy.xx的时候就会被当作php执行，这是由于在apache解析文件的时候有一个原则就是，以.后面的扩展名来解析，当遇见不认识的扩展名的时候，就会向前解析，直到遇到能够解析的后缀名为止。<br>  如：1.php.yy.xx，首先会解析xx，xx无法解析就会去解析yy，yy无法解析就会去解析php，那么php是能够解析了，那么就会结束。<br>  这种方式多用于绕过黑名单的检查。</p>
</li>
<li><p>修复建议</p>
</li>
</ul>
<p>​	 1）更新至最新版本。<br>   2）将上传的文件进行重命名。</p>
<p>三、nginx解析漏洞</p>
<ol>
<li>nginx&lt;8.03</li>
</ol>
<ul>
<li>nginx配置文件错误</li>
</ul>
<p>​	由于nginx默认是用cgi解析php的，因此和iis一样可以制作图片马进行上传。<br>   当在图片文件中写入后门代码，当访问这个图片的时候加上&#x2F;.php的时候就会在当前目录下生成一句话木马shell.php。</p>
<ul>
<li>修复建议</li>
</ul>
<p>​	1）配置cgi.fix_pathinfo(php.ini中)为0并重启php-cgi程序<br> <img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202505041651060.png" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<p>​	2）或如果需要使用到cgi.fix_pathinfo这个特性（例如：Wordpress），那么可以禁止上传目录的执行脚本权限。 或将上传存储的内容与网站分离，即站库分离。</p>
<p>​	3）或高版本PHP提供了security.limit_extensions这个配置参数，设置security.limit_extensions &#x3D; .php</p>
<ol start="2">
<li>nginx 0.5&#x2F;0.6&#x2F;0.7&lt;&#x3D;0.7.65&#x2F;0.8&lt;&#x3D;0.8.37</li>
</ol>
<ul>
<li>nginx空字节任意代码执行</li>
</ul>
<p>​	当使用PHP-FastCGI执行PHP时，遇到url里面存在%00空字节时与FastCGI的处理不一致，导致可在非PHP文件中嵌入PHP代码，通过访问url+%00.PHP来执行其中的PHP代码。<br>   比如上传一张图片马1.jpg，那么当访问这个图片马的时在1.jpg后面添加%00.php就会将图片马以php执行。</p>
<ul>
<li>修复建议</li>
</ul>
<p>​	1）升级nginx版本。</p>
<h4 id="名字改造"><a href="#名字改造" class="headerlink" title="名字改造"></a>名字改造</h4><p>一、filename改造</p>
<p>注意是对filename改造，不是对上传文件名改造</p>
<p>（1） 名字特殊符号替换以及构造异常闭合（符号方法很多自己天马星空，我这里就写几个就行了，但是要注意你改造了得让后端识别到，乱改造识别不到等于白搭）</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">filename</span>=<span class="hljs-string">&#x27;shell.jspx.jsp&#x27;</span><br><span class="hljs-attribute">filename</span>=shell.jspx.jsp<br><span class="hljs-attribute">filename</span>=shell.jspx.jsp&#x27;<br><span class="hljs-string">&quot;filename&quot;</span>=shell.jspx;<br></code></pre></td></tr></table></figure>

<p>（2）重写</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">filename</span><span class="hljs-operator">=</span>shell.jpg<span class="hljs-comment">;filename=shell.jspx;</span><br><span class="hljs-attribute">filename</span><span class="hljs-operator">=</span>shell.jspx<span class="hljs-comment">;filename=shell.jpg;</span><br></code></pre></td></tr></table></figure>

<p>（3）大小写变化</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">FileName</span>=shell.jspx.jsp&#x27;<br></code></pre></td></tr></table></figure>

<p>（4）参数污染</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile">FileName=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaashell.jspx.jsp&#x27;<br>FileName =shell.jspx（加空格）<br>filename====<span class="hljs-string">&quot;shell.jspx.jsp1&quot;</span>（加等号）<br>FileName =shell.jspx（前后加空格，中间也可以加特殊符号fuzz）<br></code></pre></td></tr></table></figure>

<p>（5）文件名字编码（filename一般为后端接收参数，编码了可能识别不到，这个就看情况）</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">filename=<span class="hljs-symbol">\u0073</span><span class="hljs-symbol">\u0068</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u006c</span><span class="hljs-symbol">\u006c</span><span class="hljs-symbol">\u002e</span><span class="hljs-symbol">\u006a</span><span class="hljs-symbol">\u0073</span><span class="hljs-symbol">\u0070</span><br></code></pre></td></tr></table></figure>

<p>（6）回车换行（有时候确实挺好用的，任意位置都可以试一下）</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">FileName</span><span class="hljs-operator">=</span>shell.jspx.<br>jsp<br></code></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">File</span><br><span class="hljs-keyword">Name</span>=shell.jspx.jsp<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>

<p>二、name改造</p>
<p>name也可以任意改造，改造的方法和filename差不多，就不重复发了，主要是思路重要。</p>
<p>其他的比如奇奇怪怪的正则需要用到的特殊字符都可以在文件名中fuzz一下，看看能否打断waf规则，也就是把我们fuzz后缀的再跑一次，或者再找点其他的正则字母，这里就不重复写了。</p>
<p>还有一些数据溢出啥的绕过方式，这里并不提及，读者可参考下文：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zzz6583zz/article/details/141608529">https://blog.csdn.net/zzz6583zz/article/details/141608529</a></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/HasntStartIsOver/article/details/130910722" title="WEB入门——文件上传漏洞_htaccess文件上传漏洞-CSDN博客">WEB入门——文件上传漏洞_htaccess文件上传漏洞-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44268918/article/details/128074253" title="文件上传漏洞全解析：策略、绕过与安全修复-CSDN博客">文件上传漏洞全解析：策略、绕过与安全修复-CSDN博客</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Web/" class="category-chain-item">Web</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" class="print-no-link">#学习总结</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>文件上传学习总结</div>
      <div>http://example.com/2025/05/04/文件上传学习总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>sangnigege</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年5月4日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/05/04/upload-labs%E9%80%9A%E5%85%B3%E5%85%A8%E8%AF%A6%E8%A7%A3/" title="upload-labs通关全详解">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">upload-labs通关全详解</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/05/04/XSS-CTFHub/" title="XSS-CTFHub">
                        <span class="hidden-mobile">XSS-CTFHub</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"TKccC2BvrQ0jKroA5aUdv8tr-gzGzoHsz","appKey":"rSHs3EnI9lT7nQwv5J7fcBnq","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a>
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
